<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    
    <title>Tsunamori&#39;s blog</title>
    
    
        <meta name="keywords" content="Tsunamori&#39;s blog">
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta property="og:type" content="website">
<meta property="og:title" content="Tsunamori&#39;s blog">
<meta property="og:url" content="https://tsunamori.github.io/page/2/index.html">
<meta property="og:site_name" content="Tsunamori&#39;s blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Tsunamori">
<meta name="twitter:card" content="summary">
    

    
        <link rel="alternate" href="/atom.xml" title="Tsunamori&#39;s blog" type="application/atom+xml">
    

    
        <link rel="icon" href="/favicon.ico">
    

    
<link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">

    
<link rel="stylesheet" href="/libs/open-sans/styles.css">

    
<link rel="stylesheet" href="/libs/source-code-pro/styles.css">


    
<link rel="stylesheet" href="/css/style.css">

    
<script src="/libs/jquery/2.1.3/jquery.min.js"></script>

    
<script src="/libs/jquery/plugins/cookie/1.4.1/jquery.cookie.js"></script>

    
    
        
<link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">

    
    
        
<link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">

    
    
    
    


    
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">Tsunamori&#39;s blog</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/">首页</a>
                
                    <a class="main-nav-link" href="/archives">归档</a>
                
                    <a class="main-nav-link" href="/categories">分类</a>
                
                    <a class="main-nav-link" href="/tags">标签</a>
                
                    <a class="main-nav-link" href="/about">关于</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="https://www.gravatar.com/avatar/bf0a499c8b2705f83e63c534d6cd38a2">
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search">
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something...">
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>


</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/">首页</a></td>
                
                    <td><a class="main-nav-link" href="/archives">归档</a></td>
                
                    <td><a class="main-nav-link" href="/categories">分类</a></td>
                
                    <td><a class="main-nav-link" href="/tags">标签</a></td>
                
                    <td><a class="main-nav-link" href="/about">关于</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search">
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="https://www.gravatar.com/avatar/bf0a499c8b2705f83e63c534d6cd38a2?s=128">
            <h2 id="name">Tsunamori</h2>
            <h3 id="title">The green hat hacker</h3>
            <span id="location"><i class="fa fa-map-marker"></i>Moon the other side</span>
            <a id="follow" target="_blank" href="https://github.com/Tsunamori/" rel="external nofollow noopener noreferrer">FOLLOW</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                15
                <span>posts</span>
            </div>
            <div class="article-info-block">
                10
                <span>tags</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="https://github.com/Tsunamori" target="_blank" title="github" class="tooltip" rel="external nofollow noopener noreferrer">
                            <i class="fa fa-github"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/atom.xml" target="_blank" title="rss" class="tooltip">
                            <i class="fa fa-rss"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            
                <aside id="sidebar">
   
        
    <div class="widget-wrap" id="categories">
        <h3 class="widget-title">
            <span>categories</span>
            &nbsp;
            <a id="allExpand" href="#">
                <i class="fa fa-angle-double-down fa-2x"></i>
            </a>
        </h3>
        
        
        
         <ul class="unstyled" id="tree"> 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            其它笔记
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/%E7%8E%B0%E9%98%B6%E6%AE%B5%E5%AF%B9blog%E7%9A%84%E8%A7%84%E5%88%92%E6%80%9D%E8%80%83/">现阶段对blog的规划思考</a></li>  <li class="file"><a href="/wiki/blog%E9%87%8D%E6%9E%84%E5%95%A6/">blog重构啦！</a></li>  <li class="file"><a href="/wiki/%E5%85%B3%E5%85%B3%E9%9A%BE%E8%BF%87%E5%85%B3%E5%85%B3%E8%BF%87/">关关难过关关过</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            学习笔记
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/%E8%AF%95%E7%8E%A9Game-of-hacks/">Game of hacks 试玩</a></li>  <li class="file"><a href="/wiki/%E5%81%B7%E5%AD%A6%E7%9A%84%E6%B8%97%E9%80%8F%E5%B0%8Ftips/">偶然学到的渗透小tips</a></li>  <li class="file"><a href="/wiki/%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">服务网格学习笔记</a></li>  <li class="file"><a href="/wiki/Chatgpt%E7%BF%BB%E8%AF%91%E5%A4%96%E6%96%87%E4%B9%A6%E7%B1%8D%E5%88%9D%E4%BD%93%E9%AA%8C/">Chatgpt翻译外文书籍初体验</a></li>  <li class="file"><a href="/wiki/Logseq%E4%BD%BF%E7%94%A8%E4%BD%93%E9%AA%8C/">Logseq使用体验</a></li>  <li class="file"><a href="/wiki/%E9%AA%8C%E8%AF%81%E7%A0%81%E7%88%86%E7%A0%B4-xp-CAPTCHA%E6%8C%96%E6%B4%9E%E4%BD%93%E9%AA%8C/">验证码爆破-xp_CAPTCHA挖洞体验</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            读书笔记
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/Notes_HowToHunt-md/">Notes for HowToHunt.md</a></li>  <li class="file"><a href="/wiki/Notes_0-to-1-the-road-of-CTFer_1/">0 to 1 the road of CTFer 第一章 Web入门</a></li>  <li class="file"><a href="/wiki/Notes_%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-%E4%BC%81%E4%B8%9A%E7%BA%A7web%E4%BB%A3%E7%A0%81%E5%AE%89%E5%85%A8%E7%BB%93%E6%9E%84/">代码审计 企业级web代码安全结构</a></li>  <li class="file"><a href="/wiki/Note-JAVA%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-%E5%85%A5%E9%97%A8%E7%AF%87/">note_JAVA代码审计-入门篇</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            踩坑记录
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/kali%E7%9A%84VPN%E4%BB%A3%E7%90%86%E8%BD%AF%E4%BB%B6%E9%80%89%E6%8B%A9/">在kali上安装clash/V2raya的教程</a></li>  <li class="file"><a href="/wiki/%E4%B8%80%E6%AC%A1%E5%B7%AE%E7%82%B9%E7%BF%BB%E8%BD%A6%E7%9A%84v2raya%E7%89%88%E6%9C%AC%E6%9B%B4%E6%96%B0%E7%BB%8F%E5%8E%86/">一次差点翻车的kali v2raya版本更新经历</a></li>  </ul> 
                    </li> 
                     </ul> 
    </div>
    <script>
        $(document).ready(function() {
            var iconFolderOpenClass  = 'fa-folder-open';
            var iconFolderCloseClass = 'fa-folder';
            var iconAllExpandClass = 'fa-angle-double-down';
            var iconAllPackClass = 'fa-angle-double-up';
            // Handle directory-tree expansion:
            // 左键单独展开目录
            $(document).on('click', '#categories a[data-role="directory"]', function (event) {
                event.preventDefault();

                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconFolderOpenClass);
                var subtree = $(this).siblings('ul');
                icon.removeClass(iconFolderOpenClass).removeClass(iconFolderCloseClass);
                if (expanded) {
                    if (typeof subtree != 'undefined') {
                        subtree.slideUp({ duration: 100 });
                    }
                    icon.addClass(iconFolderCloseClass);
                } else {
                    if (typeof subtree != 'undefined') {
                        subtree.slideDown({ duration: 100 });
                    }
                    icon.addClass(iconFolderOpenClass);
                }
            });
            // 右键展开下属所有目录
            $('#categories a[data-role="directory"]').bind("contextmenu", function(event){
                event.preventDefault();
                
                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconFolderOpenClass);
                var listNode = $(this).siblings('ul');
                var subtrees = $.merge(listNode.find('li ul'), listNode);
                var icons = $.merge(listNode.find('.fa'), icon);
                icons.removeClass(iconFolderOpenClass).removeClass(iconFolderCloseClass);
                if(expanded) {
                    subtrees.slideUp({ duration: 100 });
                    icons.addClass(iconFolderCloseClass);
                } else {
                    subtrees.slideDown({ duration: 100 });
                    icons.addClass(iconFolderOpenClass);
                }
            })
            // 展开关闭所有目录按钮
            $(document).on('click', '#allExpand', function (event) {
                event.preventDefault();
                
                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconAllExpandClass);
                icon.removeClass(iconAllExpandClass).removeClass(iconAllPackClass);
                if(expanded) {
                    $('#sidebar .fa.fa-folder').removeClass('fa-folder').addClass('fa-folder-open')
                    $('#categories li ul').slideDown({ duration: 100 });
                    icon.addClass(iconAllPackClass);
                } else {
                    $('#sidebar .fa.fa-folder-open').removeClass('fa-folder-open').addClass('fa-folder')
                    $('#categories li ul').slideUp({ duration: 100 });
                    icon.addClass(iconAllExpandClass);
                }
            });  
        });
    </script>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title"><span>archives</span></h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/11/">November 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a><span class="archive-list-count">2</span></li></ul>
        </div>
    </div>

    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>
            
            <section id="main">
        <article id="post-Note-JAVA代码审计-入门篇" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
                    <div class="article-meta">
                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link-link" href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" rel="tag">代码审计</a>
    </div>

                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/wiki/Note-JAVA%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-%E5%85%A5%E9%97%A8%E7%AF%87/">
            <time datetime="2021-09-22T01:47:07.000Z" itemprop="datePublished">2021-09-22</time>
        </a>
    </div>


                        
                            <i class="fa fa-bar-chart"></i>
                            <span id="busuanzi_container_site_pv"><span id="busuanzi_value_page_pv"></span></span>    
                        
                        
                            <div class="article-meta-button">
                                <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Tsunamori/Wiki-site/raw/writing/source/_posts/Note-JAVA代码审计-入门篇.md"> Source </a>
                            </div>
                            <div class="article-meta-button">
                                <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Tsunamori/Wiki-site/edit/writing/source/_posts/Note-JAVA代码审计-入门篇.md"> Edit </a>
                            </div>
                            <div class="article-meta-button">
                                <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Tsunamori/Wiki-site/commits/writing/source/_posts/Note-JAVA代码审计-入门篇.md"> History </a>
                            </div>
                        
                    </div>
                
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/wiki/Note-JAVA%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-%E5%85%A5%E9%97%A8%E7%AF%87/">note_JAVA代码审计-入门篇</a>
        </h1>
    

            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
        
            
        
        
            <h2 id="第1章-初识JAVA代码审计"><a href="#第1章-初识JAVA代码审计" class="headerlink" title="第1章 初识JAVA代码审计"></a>第1章 初识JAVA代码审计</h2><h2 id="第2章-代码审计环境搭建"><a href="#第2章-代码审计环境搭建" class="headerlink" title="第2章 代码审计环境搭建"></a>第2章 代码审计环境搭建</h2><ol>
<li>使用环境：JAVA JDK、Docker、Vulhub、IntelliJ IDEA(远程调试)、VMware、Maven</li>
</ol>
<h2 id="第3章-代码审计辅助工具简介"><a href="#第3章-代码审计辅助工具简介" class="headerlink" title="第3章 代码审计辅助工具简介"></a>第3章 代码审计辅助工具简介</h2><ol>
<li>代码编辑器：Sublime、IDEA、Eclipse</li>
<li>测试工具：Burp Suite、SwitchyOmega、Max HackerBar、Postman、Postwoman、Tamper Data、Ysoserial、Marshalsec、MySQL监视工具、Beyond Compare</li>
<li>反编译工具：JD-GUI、FernFLower、CFR、IntelliJ IDEA</li>
<li>JAVA代码静态扫描工具：Fortify、VCG、FindBugs与FindSecBugs插件、SpotBugs</li>
<li>公开漏洞查找平台：CVE、NVD、CNVD、CNNVD</li>
</ol>
<h2 id="Java-EE基础知识"><a href="#Java-EE基础知识" class="headerlink" title="Java EE基础知识"></a>Java EE基础知识</h2><h3 id="Java-EE"><a href="#Java-EE" class="headerlink" title="Java EE"></a>Java EE</h3><h4 id="Java-EE常用核心技术"><a href="#Java-EE常用核心技术" class="headerlink" title="Java EE常用核心技术"></a>Java EE常用核心技术</h4><ol>
<li>Java 数据库连接 （JDBC）：用于规范客户端程序如何访问数据库的应用程序接口。</li>
<li>Java 命名和目录接口（JNDI）：Java的一个目录服务应用程序界面（API），将服务名称和对象关联起来，从而使开发可以用名称来访问对象。</li>
<li>企业级JavaBean（EJB）：用来构筑企业级应用的、在服务端可被管理的组件。</li>
<li>远程方法调用（RMI）：是Java的一组用户开发分布式应用程序的API，增强Java开发分布式应用的能力。</li>
<li>Servlet：是使用Java编写的服务端程序，狭义的Servlet指Java语言实现的一个接口，广义上指任何实现该Servlet接口的类。主要功能在于交互式地浏览和修改数据，生成动态内容。</li>
<li>JSP（JavaServer Pages）：一种动态网页技术标准，部署在网络服务器上，可以相应用户端发送的请求，并根据请求内容动态生成HTML、XML或其他格式文档的Web网页，返回给请求者。</li>
<li>可扩展标记语言（XML）：是被设计用于传输和存储数据的语言。</li>
<li>Java消息服务（Java Message Service, JMS）是一个Java平台中关于面向消息中间件（MOM）的API，用于在两个应用程序之间或分布式系统中发生消息，进行异步通信。</li>
</ol>
<h4 id="Java-EE-分层模型"><a href="#Java-EE-分层模型" class="headerlink" title="Java EE 分层模型"></a>Java EE 分层模型</h4><ol>
<li>Domain Object(领域对象)层：由一系列POJO（Plain Old Java Object）组成，这些对象是该系统的Domain Object，通常包含各自所需实现的业务逻辑方法。</li>
<li>DAO(Data Access Object, 数据访问对象)层：由一系列DAO组件组成，实现对数据库创建、查询、更新、删除等操作。</li>
<li>Service(业务逻辑)层：由一系列控制器组成，用于拦截用户请求，并调用业务逻辑组件的业务逻辑方法处理用户请求，根据处理结果向不同View组件转发。</li>
<li>View(表现)层：由一系列页面及视图组件组成，负责收集用户请求，并显示处理后的结果。</li>
</ol>
<h3 id="MVC"><a href="#MVC" class="headerlink" title="MVC"></a>MVC</h3><p>MVC，即为Model View Controller，三个核心部件，独自处理各自的任务。这种分离思想应用在代码审计中，以抓住关键问题。</p>
<h4 id="Java-MVC"><a href="#Java-MVC" class="headerlink" title="Java MVC"></a>Java MVC</h4><ol>
<li>Model：表示携带数据的对象或Java POJO，即使模型内的数据改变，它也具有逻辑来更新控制器。</li>
<li>Controller：表示逻辑控制，它对模型和视图都有作用，控制数据流进入模型对象，并在数据更改时更新视图，是视图和模型的中间层。</li>
<li>View：表示模型包含的数据的可视化层。<br>工作流程：控制层接收用户请求，决定调用哪个模型，模型处理用户请求并返回数据，最后由视图层将数据转化呈现给用户。MVC模式使视图层和业务层分离，比如修改View层代码时，不用重新编译Model和Controller代码。</li>
</ol>
<h4 id="Java-MVC框架"><a href="#Java-MVC框架" class="headerlink" title="Java MVC框架"></a>Java MVC框架</h4><ol>
<li>Struts1</li>
<li>Struts2</li>
<li>Spring MVC</li>
<li>JSF</li>
<li>Tapestry</li>
</ol>
<h3 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h3>
            </div>
        
        <footer class="article-footer">
        </footer>
    </div>
</article>






    
        <article id="post-Notes_代码审计-企业级web代码安全结构" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
                    <div class="article-meta">
                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link-link" href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" rel="tag">代码审计</a>
    </div>

                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/wiki/Notes_%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-%E4%BC%81%E4%B8%9A%E7%BA%A7web%E4%BB%A3%E7%A0%81%E5%AE%89%E5%85%A8%E7%BB%93%E6%9E%84/">
            <time datetime="2021-07-17T02:05:28.000Z" itemprop="datePublished">2021-07-17</time>
        </a>
    </div>


                        
                            <i class="fa fa-bar-chart"></i>
                            <span id="busuanzi_container_site_pv"><span id="busuanzi_value_page_pv"></span></span>    
                        
                        
                            <div class="article-meta-button">
                                <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Tsunamori/Wiki-site/raw/writing/source/_posts/Notes_代码审计-企业级web代码安全结构.md"> Source </a>
                            </div>
                            <div class="article-meta-button">
                                <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Tsunamori/Wiki-site/edit/writing/source/_posts/Notes_代码审计-企业级web代码安全结构.md"> Edit </a>
                            </div>
                            <div class="article-meta-button">
                                <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Tsunamori/Wiki-site/commits/writing/source/_posts/Notes_代码审计-企业级web代码安全结构.md"> History </a>
                            </div>
                        
                    </div>
                
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/wiki/Notes_%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-%E4%BC%81%E4%B8%9A%E7%BA%A7web%E4%BB%A3%E7%A0%81%E5%AE%89%E5%85%A8%E7%BB%93%E6%9E%84/">代码审计 企业级web代码安全结构</a>
        </h1>
    

            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
        
            
        
        
            <p>苦于代码审计能力偏弱，调研一番发现这本书或许有所帮助。</p>
<h2 id="第一部分-代码审计前的准备"><a href="#第一部分-代码审计前的准备" class="headerlink" title="第一部分 代码审计前的准备"></a>第一部分 代码审计前的准备</h2><h3 id="代码审计环境搭建"><a href="#代码审计环境搭建" class="headerlink" title="代码审计环境搭建"></a>代码审计环境搭建</h3><ol>
<li>wamp/wnmp: WAMP（Windows下的Apache+Mysql/MariaDB+Perl/PHP/Python），WNMP（Windows下的Nginx+Mysql+PHP）</li>
<li>lamp/lnmp：将上述环境安装在Linux中。</li>
</ol>
<h4 id="PHP-INI-常量的定义"><a href="#PHP-INI-常量的定义" class="headerlink" title="PHP_INI_*常量的定义"></a>PHP_INI_*常量的定义</h4><ol>
<li>PHP_INI_USER：该配置选项可在用户的PHP脚本或Win注册表中设置。</li>
<li>PHP_INI_PERDIR：该配置选项可在php.ini. .htaccess或httpd.conf中设置。</li>
<li>PHP_INI_SYSTEM：该配置选项可在任何地方设置。</li>
<li>PHP_INI_ALL：该配置选项可在任何地方设置。</li>
<li>php.ini only：该配置选项可仅可在php.ini中配置。</li>
</ol>
<h4 id="会影响PHP脚本安全的配置列表及核心配置选项"><a href="#会影响PHP脚本安全的配置列表及核心配置选项" class="headerlink" title="会影响PHP脚本安全的配置列表及核心配置选项"></a>会影响PHP脚本安全的配置列表及核心配置选项</h4><ol>
<li>register_globals(全局变量注册开关)：该选项在on的情况下，会将用户GET/POST等方式提交上来的参数注册成全局变量并初始化值为参数对应的值，使提交参数可以直接在脚本中使用。register_globals在PHP版本小于等于4.2.3时设置为PHP_INI_ALL，从PHP5.3.0起被废弃，在PHP5.4.0中被移除。<br> 代码实例：(实验环境php5.2.17,在php.ini中添加register_globals = On) <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if($user&#x3D;&#x3D;&#39;admin&#39;)&#123;</span><br><span class="line">  echo &#39;true&#39;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>allow_url_include(是否允许包含远程文件)：在该配置为on的情况下，可以直接包含远程文件，当存在include(<code>$var</code>)且$var可控的情况下，可以直接控制$var变量来执行PHP代码。allow_url_include在PHP5.2.0后默认设置为off，配置范围为PHP_INI_ALL。与之类似的配置有allow_url_fopen，配置是否允许打开远程文件，但安全隐患没有前者大。<br> 代码实例：(实验环境php5.2.17，payload：a=<a target="_blank" rel="external nofollow noopener noreferrer" href="http://127.0.0.1/test/info.txt">http://127.0.0.1:80/test/info.txt</a> ，info.txt内容为<code>&lt;?php phpinfo();?&gt;</code>) <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include $_GET[&#39;a&#39;];</span><br></pre></td></tr></table></figure></li>
<li>magic_quotes_gpc（魔术引号自动过滤）：该参数在不存在编码或其他特殊绕过的情况下，可以使很多漏洞无法利用。当该参数被开启时（选项设置为on），会自动在GET、POST、COOKIE变量中的单引号（‘）、双引号（“）、反斜杠（\）及空字符（NULL）的前面加上反斜杠（\），但在PHP5中magic_quotes_gps并不会过滤$_SERVER变量，导致很多类似client-ip、referer一类的漏洞能够利用。PHP5.3之后不推荐使用该参数，PHP5.4之后被取消。在PHP版本小于4.2.3时，配置范围是PHP_INI_ALL;在PHP版本大于4.2.3时，是PHP_INI_PERDIR。<br> 代码实例：(测试?a=1’) <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">echo $_GET[&#39;a&#39;];</span><br></pre></td></tr></table></figure></li>
<li>magic_quotes_runtime(魔术引号自动过滤)：过滤方式同样为加反斜杠，但和magic_quotes_gpc的处理对象不一样。magic_quotes_runtime只对从数据库或文件中获取的数据进行过滤，magic_quotes_runtime在PHP5.4之后被取消，配置范围是PHP_INI_ALL。但该参数仅对部分函数有作用，某些情况下可以被绕过。<br> 代码实例： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#1.txt</span><br><span class="line">1&#39;2&quot;3\4</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">ini_set(&quot;magic_quotes_runtime&quot;,&quot;1&quot;);</span><br><span class="line">echo file_get_contents(&quot;1.txt&quot;);</span><br></pre></td></tr></table></figure></li>
<li>magic_quotes_sybase(魔术引号自动过滤)：用于自动过滤特殊字符，当设置为on时，会覆盖magic_quotes_gpc=on的配置（使gpc=on失效）。与gpc的共同点是处理对象一致（GET、POST、Cookie)，但该参数仅转义空字符以及把单引号变成双引号，使用率比gpc低。配置范围为PHP_INI_ALL，在PHP5.4.0中移除。（代码实例与gpc相同）</li>
<li>safe_mode（安全模式）：是PHP内嵌的一种安全机制，配置范围为PHP_INI_SYSTEM，PHP5.4之后被取消（取消原因是，PHP开发者认为在PHP语言机制上试图解决安全问题是一件不合适的事情，虽然safe_mode在一定程度上对共享主机有效，但同时也带来了不少误报，与其在PHP上解决权限安全问题，不如使用linux默认的权限限制机制或其它层级的解决办法）。该参数效果为，所有文件操作函数都会受到限制，非文件所有者不能对该文件进行操作（如include()），如果有一些脚本文件放在非Web服务启动用户所有的目录下，需要利用include等函数进行加载，可以使用safe_mode_include_dir来配置可包含的路径。此外，通过函数popen()、system()以及exec()等函数执行命令或程序会提示错误，如果需要使用外部脚本，可以集中存放，然后用safe_node_exec_dir来指向存放目录。<br> 代码实例： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># echo &#96;whoami&#96;; 执行命令失败的回显提示</span><br><span class="line">Warning: shell_exec() [function, shell_exec]: Cannot execute using backquotes in Safe Mode ...</span><br></pre></td></tr></table></figure></li>
<li>open_basedir（PHP可访问目录）：用于限制PHP只能访问哪些目录，通常只需要设置Web文件目录即可，如果需要加载外部脚本，也需要把所在路径加入该指令中，多个目录以分号分割。需要注意，指定限制实际上是前缀而不是目录名，如配置open_basedir=/www/a，那么/www/a和/www/ab都可以访问，所以为了避免该现象发生，需要用斜线结束路径名，如/www/a/。当参数激活，执行脚本访问其它文件时都需要验证文件路径，所以会影响执行效率。该指令配置范围在PHP&lt;5.2.3时是PHP_INI_SYSTEM，在PHP&gt;=5.2.3时是PHP_INI_ALL。</li>
<li>disable_functions(禁用函数)：使用该指令来禁止敏感函数的使用，使用本指令时，需把dl()函数也添加进禁用列表，否则攻击者可以利用dl()函数价值自定义的PHP扩展突破该指令的限制。指令范围为php.ini，配置禁用函数时使用逗号分割函数名。</li>
<li>display_errors和error_reporting错误显示：display_errors用于表明是否显示PHP脚本内部错误，生产环境中建议关闭，在开启时，可以通过设置error_reporting来设置错误显示的级别。配置范围均为PHP_INI_ALL。</li>
</ol>
<h3 id="审计辅助与漏洞验证工具"><a href="#审计辅助与漏洞验证工具" class="headerlink" title="审计辅助与漏洞验证工具"></a>审计辅助与漏洞验证工具</h3><h4 id="代码编辑器"><a href="#代码编辑器" class="headerlink" title="代码编辑器"></a>代码编辑器</h4><ol>
<li>Notepad++</li>
<li>UltraEdit（文件对比）</li>
<li>Zend Studio（PHP集成开发环境）</li>
</ol>
<h4 id="代码审计工具"><a href="#代码审计工具" class="headerlink" title="代码审计工具"></a>代码审计工具</h4><ol>
<li>Seay源代码审计系统</li>
<li>RIPS</li>
</ol>
<h4 id="漏洞验证辅助"><a href="#漏洞验证辅助" class="headerlink" title="漏洞验证辅助"></a>漏洞验证辅助</h4><ol>
<li>Burp</li>
<li>浏览器扩展：Hackbar, Firebug, Live HTTP Headers, Modify</li>
<li>编码转换及加解密工具：Seay代码审计系统自带的编码功能，Burp自带的decoder，超级加解密转换工具</li>
<li>正则调试工具：Seay自带的正则调试功能，灵者正则调试</li>
<li>SQL执行监控工具：Seay mysql监控</li>
</ol>
<h2 id="漏洞发现与防范"><a href="#漏洞发现与防范" class="headerlink" title="漏洞发现与防范"></a>漏洞发现与防范</h2><h3 id="通用代码审计思路"><a href="#通用代码审计思路" class="headerlink" title="通用代码审计思路"></a>通用代码审计思路</h3><h4 id="敏感函数回溯参数过程"><a href="#敏感函数回溯参数过程" class="headerlink" title="敏感函数回溯参数过程"></a>敏感函数回溯参数过程</h4><p>根据敏感函数来逆向追踪参数的传递过程，使用较多，因为大多数漏洞都是由于函数使用不当造成的。非函数使用不当的漏洞，如SQL注入，也有一些特征，如Select、Incert等，结合From和Where等关键字判断是否为一条SQL语句，通过对字符串的识别分析，就能判断该SQL语句参数有没有使用单引号过滤，或者根据经验判断。如HTTP头里面的HTTP_CLIENT_IP和HTTP_X_FORWORDFOR等获取到的IP地址常直接拼接到SQL语句中，且由于它们是存在于<code>$_SERVER</code>变量中不受GPC的影响，那么就可以查找这两个参数关键字快速寻找漏洞。<br>该方法的优点是定向挖掘、高效、高质量，缺点是对整体框架了解不够深入，定位利用点会花费时间，另外无法覆盖逻辑漏洞。</p>
<h4 id="通读全文代码"><a href="#通读全文代码" class="headerlink" title="通读全文代码"></a>通读全文代码</h4><p>在企业中做自身产品代码审计时，我们需要了解整个应用的业务逻辑以获取更多漏洞。<br>通读全文代码时，首先要看程序的大体代码结构，如主目录有哪些文件，模块目录有哪些文件，插件目录有哪些文件，还要注意文件大小、创建时间。根据文件命名可大致了解该程序实现哪些功能，核心文件是哪些。<br>在看程序目录结构时，要特别注意以下几个文件：</p>
<ol>
<li><code>函数集文件</code>，通常命名中包含functions或者common等关键字，这些文件内是一些公共函数，提供给其它文件统一调用，所以大多数文件会在文件头包含其它文件。寻找这些文件的一个技巧就是打开index.php或一些功能性文件，在头部一般都能找到。</li>
<li><code>配置文件</code>，通常命名中包含config关键字，包括Web程序运行必须的功能性配置选项及数据库等配置信息，从该文件中可以了解程序的小部分功能，另外看这个文件时注意观察配置文件中参数值是用单引号还是双引号，如果是双引号，则很可能存在代码执行漏洞。（如利用PHP可变变量（$$a）的特性执行代码，ref：<a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.cnblogs.com/Cl0ud/p/12336834.html%EF%BC%89">https://www.cnblogs.com/Cl0ud/p/12336834.html）</a></li>
<li><code>安全过滤文件</code>，该文件关系到挖掘到的可疑点能否利用，通常命名中有filter、safe、check等关键字。这类文件主要作用是针对参数进行过滤，比较常见的是针对SQL注入和XSS过滤，还有文件路径、执行的系统命令的参数，其它相对少见。而目前大多数应用会在程序入口循环对所有参数使用addslashes()进行过滤。</li>
<li><code>index文件</code>，是一个程序的入口文件，通过阅读该文件可大致了解整个程序的架构、运行流程、包含的文件，以及核心文件有哪些。而不同的目录的index文件也有不同的实现方式，最好先将核心目录的index文件都简单读一遍。<br>学习代码审计前期建议先下载一些小应用来读，积累经验后，再去读开源框架。</li>
</ol>
<h4 id="根据功能点定向审计"><a href="#根据功能点定向审计" class="headerlink" title="根据功能点定向审计"></a>根据功能点定向审计</h4><p>先简单黑盒测试一下，再通过发现的容易出问题的功能去阅读该功能点的源码，提高审计速度。</p>
<ol>
<li>文件上传功能：任意上传、SQL注入</li>
<li>文件管理功能：任意文件操作、XSS漏洞</li>
<li>登录认证功能：任意用户登录</li>
<li>找回密码功能：验证码爆破、验证凭证算法</li>
</ol>
<h3 id="漏洞挖掘与防范（基础篇）"><a href="#漏洞挖掘与防范（基础篇）" class="headerlink" title="漏洞挖掘与防范（基础篇）"></a>漏洞挖掘与防范（基础篇）</h3><h4 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h4><h5 id="挖掘经验"><a href="#挖掘经验" class="headerlink" title="挖掘经验"></a>挖掘经验</h5><p>常出现在登录页面、获取HTTP头（user-agent/client-ip等）、订单处理等业务相对复杂的地方，登录页面注入大多出现在HTTP头的client-ip和x-forward-for，用于记录登录IP地址。另外在订单系统内，由于订单涉及购物车等多个交互，经常会发生二次注入，通读代码时可着重关注这几个地方。</p>
<ol>
<li>普通注入：指最容易利用的SQL注入漏洞，有int型和string型，在string型注入中需要使用单或双引号闭合。数据库操作存在一些关键字，如select from、mysql_connect、mysql_query、mysql_fetch_row等，查询方式还有update、incert、delete，只需要在白盒审计中查找这些关键字即可定向挖掘SQL注入。</li>
<li>编码注入：程序在进行一些操作前经常会进行编码处理，而做编码处理的函数可能会存在问题。通过输入转码函数不兼容的特殊字符，即可导致输出字符变成有害数据，在SQL注入里，最常见的编码注入是MySQL宽字节以及urldecode/rawurldecode函数导致的。<ul>
<li>宽字节注入：使用PHP连接MySQL的时候，当设置<code>set character_set_client=gbk</code>时会导致一个编码转换的注入问题，当存在该漏洞时，注入参数里带入<code>%df%27</code>，即可把程序中过滤的<code>\(%5c)</code>吃掉。而通常都不是直接设置<code>set character_set_client=gbk</code>，而是设置<code>SET NAMES ‘gbk’</code>，同样存在漏洞。官方建议是使用mysql_set_charset来设置编码，只要在后面合理的使用mysql_real_escape_string还是可以解决该漏洞的。对宽字节注入的挖掘方法比较简单，搜索<code>SET NAMES</code>、<code>character_set_client=gbk</code>、<code>mysql_set_charset(&#39;gbk&#39;)</code>。该漏洞的解决方法如以下三种，比较推荐一和三：<ul>
<li>在执行查询前先执行<code>SET NAMES &#39;gbk&#39;, character_set_client=binary</code></li>
<li>使用mysql_set_charset(‘gbk’)设置编码，然后使用mysql_real_escape_string()过滤。</li>
<li>使用pdo方式，在PHP5.3.6及以下版本中需要设置<code>setAttribute(PDO::ATTR_EMULATE_PREPARES,false);</code>，来禁用prepared statements的仿真效果。</li>
</ul>
</li>
<li>二次urlencode注入：只要字符被进行转换就有可能产生漏洞。现在的Web程序大多会进行参数过滤，通常使用addslashes()、mysql_real_escape_string()、mysql_escape_string()函数或者开启GPC的方式来防止注入，也就是给单引号、双引号、反斜杠（\）和NULL加上反斜杠转义。如果某处使用了urldecode或者rawurldecode函数，则会导致二次加码生成单引号而引发注入。该漏洞可以通过搜索urldecode和rawurldecode函数来挖掘。</li>
</ul>
</li>
</ol>
<h5 id="漏洞防范"><a href="#漏洞防范" class="headerlink" title="漏洞防范"></a>漏洞防范</h5><ol>
<li>gpc/runtime魔术引号：通常数据污染有两种方式，一种是应用被动接收参数，另一种是主动获取参数。利用magic_quotes_gpc和magic_quotes_runtime可以防止部分SQL注入（对int型注入没有太大作用）</li>
<li>过滤函数和类：有两种使用场景，一种是程序入口统一过滤，框架程序使用这种方式比较多，另一种是在程序进行SQL语句运行前使用，除了PHP内置的一些过滤单引号等函数外，还有一些开源类过滤union、select等关键字。<ul>
<li>addslashes函数：过滤单引号、双引号、反斜杠以及空字符NULL，大多被用在程序入口，判断如果没有开启GPC则使用该函数进行过滤。不过它的参数必须是string类，所以可能会存在通过数组绕过的漏洞。</li>
<li>mysql_[real_]escape_string函数：这两个函数都是对字符串进行过滤，只存在于大于PHP4.03的版本，[<code>\x00</code>]、[<code>\n</code>]、[<code>\r</code>]、[<code>\</code>]、[<code>&#39;</code>]、[<code>&quot;</code>]、[<code>\xla</code>]会受到影响。两个函数唯一不一样的地方在于mysql_real_escape_string接受的是一个连接句柄并根据当前字符集转移字符串，推荐使用。</li>
<li>intval等字符转换：上述方式在int类型注入时效果不会，比如可以通过报错或盲注等方式来绕过，这时候就要用到intval函数了。intval的作用是将变量转换成int类型，这里举例intval是要表达一种利用参数类型白名单的方式来防止漏洞，对应的还有很多如floatval等。</li>
</ul>
</li>
<li>PDO prepare预编译：通过预编译的方式来处理数据库查询。当PHP版本&lt;5.3.6时，使用PHP本地模拟prepare再把完整的SQL语句发送给MySQL服务器，且使用set names ‘gbk’时，仍然存在宽字节SQL注入，因为PHP和MySQL编码不一致。正确的写法应该是使用ATTR_EMULATE_PREPARES来禁用PHP本地模拟prepare。</li>
</ol>
<h4 id="XSS漏洞"><a href="#XSS漏洞" class="headerlink" title="XSS漏洞"></a>XSS漏洞</h4><h5 id="挖掘经验-1"><a href="#挖掘经验-1" class="headerlink" title="挖掘经验"></a>挖掘经验</h5><p>挖掘XSS漏洞关键在于寻找没有被过滤的参数，且这些参数传入至输出函数。常用输出函数列表如下：<code>print、print_r、echo、printf、sprintf、die、var_dump、var_export</code>，寻找带有变量的这些函数即可。另外在代码审计中，浏览器环境对XSS漏洞利用影响非常大。通读代码时可多关注各处设置资料、文章发表、留言等富文本区域，这种地方存在的XSS通常是存储型的。</p>
<h5 id="反射型-XSS"><a href="#反射型-XSS" class="headerlink" title="反射型 XSS"></a>反射型 XSS</h5><p>直接通过外部输入在浏览器端输出触发，该种漏洞比较容易通过扫描器黑盒审计发现。白盒审计中，只需要寻找带有参数的输出参数，根据输出参数对输出内容回溯输入参数，观察有没有经过过滤。</p>
<h5 id="存储型XSS"><a href="#存储型XSS" class="headerlink" title="存储型XSS"></a>存储型XSS</h5><p>把利用代码保存在数据库或文件中，当Web程序读取利用代码并输出在页面上时执行利用代码。比反射型容易利用，较为隐蔽且不用考虑绕过浏览器过滤。挖掘时也是需要寻找未过滤的输入点和未过滤的输出函数（可能完全不在同一个业务流中），可以根据当前代码功能去猜，或追寻数据有在哪里被操作，使用表名、字段名去代码里搜索。</p>
<h5 id="漏洞防范-1"><a href="#漏洞防范-1" class="headerlink" title="漏洞防范"></a>漏洞防范</h5><ol>
<li>特殊字符HTML实体转码。</li>
<li>标签事件属性黑白名单。</li>
</ol>
<h4 id="CSRF漏洞"><a href="#CSRF漏洞" class="headerlink" title="CSRF漏洞"></a>CSRF漏洞</h4><h5 id="挖掘经验-2"><a href="#挖掘经验-2" class="headerlink" title="挖掘经验"></a>挖掘经验</h5><p>主要用于越权操作，所以漏洞会出现在有权限控制的地方。黑盒挖洞可以先搭建环境，打开几个有非静态操作的页面，抓包看看有没有token，没有token就不带referer直接请求该页面，返回数据一样的话，可能存在CSRF漏洞。白盒审计，通读代码时看看被大量引用的基础文件（核心文件）、你比较关心的功能点代码内有没有验证token和referer相关的代码，或者直接搜索token关键字。</p>
<h5 id="漏洞防范-2"><a href="#漏洞防范-2" class="headerlink" title="漏洞防范"></a>漏洞防范</h5><ol>
<li>增加token/referer验证避免img标签请求的水坑攻击。</li>
<li>增加验证码。（比较麻烦，更适用于敏感操作页面）</li>
</ol>
<h3 id="漏洞挖掘与防范（进阶篇）"><a href="#漏洞挖掘与防范（进阶篇）" class="headerlink" title="漏洞挖掘与防范（进阶篇）"></a>漏洞挖掘与防范（进阶篇）</h3><h4 id="文件操作漏洞"><a href="#文件操作漏洞" class="headerlink" title="文件操作漏洞"></a>文件操作漏洞</h4><h5 id="文件包含漏洞"><a href="#文件包含漏洞" class="headerlink" title="文件包含漏洞"></a>文件包含漏洞</h5><p>文件包涵函数有include()、include_once()（前两个在包含文件时即使遇到错误，下面的代码仍然执行）、require()、require_once()（这两个在包含文件时遇到错误会报错退出程序）。</p>
<h6 id="挖掘经验-3"><a href="#挖掘经验-3" class="headerlink" title="挖掘经验"></a>挖掘经验</h6><p>文件包含漏洞大多出现在模块加载、模板加载以及cache调用的地方。在挖掘漏洞时可以跟踪程序运行流程，看模块加载包含的文件是否可控等，另一个是直接搜索上文四个函数来回溯寻找可控变量。一般该类漏洞都是本地文件包含，大多需要截断。</p>
<h6 id="本地文件包含"><a href="#本地文件包含" class="headerlink" title="本地文件包含"></a>本地文件包含</h6><p>本地文件包含（local file include，LFI），大多出现在模块加载、模板加载和cache调用，有多种利用方式，如上传一个允许上传的文件格式的文件再包含以执行代码，包含PHP上传的临时文件，在请求URL或ua里面加入要执行的代码，WebServer记录到日志后再包含WebServer的日志，还有像Linux下可以包含/proc/self/environ文件。</p>
<h6 id="远程文件包含"><a href="#远程文件包含" class="headerlink" title="远程文件包含"></a>远程文件包含</h6><p>远程文件包含（remote file include, RFI），需要设置allow_url_include = On，相比于本地包含来说更容易利用，但出现频率不高。</p>
<h6 id="文件包含截断"><a href="#文件包含截断" class="headerlink" title="文件包含截断"></a>文件包含截断</h6><ol>
<li>使用<code>%00</code>截断，最古老的方法，受限于GPC和addslashes等函数的过滤，另外PHP5.3之后的版本已经全面修复，不能使用该方法了。</li>
<li>使用多个英文句号<code>.</code>和反斜杠<code>/</code>来阶段，不受GPC限制，但同样在PHP5.3之后被修复。</li>
<li>远程文件包含时利用问号<code>？</code>来伪截断，不受GPC和PHP版本限制，只要能返回代码给包含函数就能执行。在HTTP协议里，访问<a target="_blank" rel="external nofollow noopener noreferrer" href="http://remotehost/i.txt%E5%92%8C%E8%AE%BF%E9%97%AEhttp://remotehost/i.txt?.php">http://remotehost/i.txt和访问http://remotehost/i.txt?.php</a> 返回的结果是一样的，因为WebServer把问号之后的内容当成请求参数，而txt不在WebServer里解析，参数对访问i.txt返回的内容不影响，实现伪截断。</li>
</ol>
<h5 id="文件读取（下载）漏洞"><a href="#文件读取（下载）漏洞" class="headerlink" title="文件读取（下载）漏洞"></a>文件读取（下载）漏洞</h5><h6 id="挖掘经验-4"><a href="#挖掘经验-4" class="headerlink" title="挖掘经验"></a>挖掘经验</h6><p>文件读取漏洞比较容易寻找，一种方式是可以先黑盒看功能点对应的文件，再去读文件源码。另一种是搜索文件读取的函数（<code>file_get_contents()、highlight_file()、fopen()、readfile()、fread()、fgetss()、fgets()、parse_ini_file()、show_source()、file()</code>），看有无可直接或间接控制的变量，除了正常读取文件的函数之外，另外一些其他功能的函数也可以用于读取文件，如include()等。</p>
<h5 id="文件上传漏洞"><a href="#文件上传漏洞" class="headerlink" title="文件上传漏洞"></a>文件上传漏洞</h5><h6 id="挖掘经验-5"><a href="#挖掘经验-5" class="headerlink" title="挖掘经验"></a>挖掘经验</h6><p>挖掘简单，上传点常调用同一个上传类，上传函数又只有move_uploaded_file()这一个，所以最快方法就是直接搜索该函数，再去看调用的代码存不存在未限制上传格式或者可以绕过，其中问题较多的是黑名单限制文件格式以及未更改文件名的方式，在未改名的情况下，在Apache利用其向前寻找解析格式和IIS6的分号解析bug都可以执行代码。</p>
<ol>
<li>未过滤或本地过滤：共同点是都未在服务器端过滤。</li>
<li>黑名单扩展名过滤：出现较少，存在限制的扩展名不够全、验证扩展名的方式存在问题可直接绕过或截断。</li>
<li>文件头、content-type验证绕过：早期出现较多，上传文件时，如果直接上传一个非图片文件会被提示不是图片文件，但只要在文件头里加上<code>GIF89a</code>后上传，则验证通过。这是因为程序用了如getimagesize()函数等。content-type是在http request请求头内，所以可以被攻击者修改，而早期的一些程序只是单纯的验证了这个值。</li>
</ol>
<h5 id="文件删除漏洞"><a href="#文件删除漏洞" class="headerlink" title="文件删除漏洞"></a>文件删除漏洞</h5><p>常出现在有文件管理功能的应用上，原理和文件读取差不多，只不过利用的函数不一样，一般因为删除的文件名可以用<code>../</code>跳转，或者没有限制当前用户权限。</p>
<h6 id="挖掘经验-6"><a href="#挖掘经验-6" class="headerlink" title="挖掘经验"></a>挖掘经验</h6><p>。挖掘漏洞可以先去找相应的功能点，黑盒测试一下能不能删除某个文件，如果删除不了，再去从执行流程追踪提交的文件名参数的传递过程。如果纯白盒挖，也可以去搜索带有变量参数的unlink()，采取回溯变量的方式。</p>
<h5 id="文件操作漏洞防范"><a href="#文件操作漏洞防范" class="headerlink" title="文件操作漏洞防范"></a>文件操作漏洞防范</h5><h6 id="通用文件操作防御"><a href="#通用文件操作防御" class="headerlink" title="通用文件操作防御"></a>通用文件操作防御</h6><ol>
<li>合理的权限管理。</li>
<li>以加密等方式替代直接将文件名作为下载参数的操作。</li>
<li>避免目录跳转，禁止参数中携带<code>..</code>、<code>/</code>、<code>\</code>来跳转目录。</li>
</ol>
<h6 id="文件上传漏洞防范"><a href="#文件上传漏洞防范" class="headerlink" title="文件上传漏洞防范"></a>文件上传漏洞防范</h6><ol>
<li>白名单过滤文件扩展名，使用in_array或<code>===</code>来对比扩展名。</li>
<li>保存上传文件时重命名文件，文件名采用时间戳的拼接随机数的MD5值保存方式<code>md5(time()+rand(1,10000))</code></li>
</ol>
<h4 id="代码执行漏洞"><a href="#代码执行漏洞" class="headerlink" title="代码执行漏洞"></a>代码执行漏洞</h4><h5 id="挖掘经验-7"><a href="#挖掘经验-7" class="headerlink" title="挖掘经验"></a>挖掘经验</h5><p>eval()和assert()函数导致的代码执行漏洞大多是因为载入缓存或者模板以及对变量的处理不严格导致。<br>preg_replace()函数代码执行需要存在/e参数，这个函数原本是用来处理字符串的，因此漏洞出现最多的是在对字符串的处理，比如URL、HTML标签以及文章内容等过滤功能。<br>call_user_func()和call_user_func_array()函数的功能是调用函数，多用在框架里面动态调用函数，所以一般比较小的程序不常出现该类代码执行。array_map()函数的作用是调用函数并且除第一个参数外其它参数为数组，通常会写死第一个参数，即调用的参数，类似这三个函数功能的函数还有很多。<br>还有一类非常常见的是动态函数的代码执行，如<code>$_GET($_POST[&quot;xx&quot;])</code>。</p>
<h5 id="代码执行函数"><a href="#代码执行函数" class="headerlink" title="代码执行函数"></a>代码执行函数</h5><ol>
<li>eval和assert函数：用于动态执行函数，所以它们的参数就是PHP代码。</li>
<li>preg_replace函数：对字符串进行正则处理。</li>
<li>调用函数过滤不严：数十个函数有调用其它函数的功能，如果传入的函数名可控，那么就可以调用意外的函数来执行需要的代码，即存在代码执行漏洞。这些函数有：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">call_user_func()、call_user_func_array()、array_map()、</span><br><span class="line">usort()、uasort()、uksort()、array_filter()、</span><br><span class="line">array_reduce()、array_diff_uassoc()、array_diff_ukey()、</span><br><span class="line">array_udiff()、array_udiff_assoc()、array_udiff_uassoc()、</span><br><span class="line">array_intersect_assoc()、array_intersect_uassoc、</span><br><span class="line">array_uintersect()、array_uintersect_assoc()、</span><br><span class="line">array_uintersect_uassoc()、array_walk()、array_walk_recursive()、</span><br><span class="line">xml_set_character_data_handler()、xml_set_default_handler()、</span><br><span class="line">xml_set_element_handler()、xml_set_end_namespace_decl_handler()、</span><br><span class="line">xml_set_external_entity_ref_handler()、xml_set_notation_decl_handler()、</span><br><span class="line">xml_set_processing_instruction_handler()、</span><br><span class="line">xml_set_start_namespace_decl_handler()、</span><br><span class="line">xml_set_unparsed_entity_decl_handler()、stream_filter_register()、</span><br><span class="line">set_error_handler()、register_shutdown_function()、register_tick_function()</span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="动态函数执行"><a href="#动态函数执行" class="headerlink" title="动态函数执行"></a>动态函数执行</h5><p>由于PHP的特性，PHP函数可以直接由字符串拼接，加大了安全控制的难度。PHP动态函数写法为<code>变量（参数）</code>，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$_GET[&#39;a&#39;]($_GET[&#39;b&#39;]);# poc:?a&#x3D;assert&amp;b&#x3D;phpinfo()</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>想要挖掘这种形式的代码执行漏洞，需要找可控的动态函数名。</p>
<h5 id="漏洞防范-3"><a href="#漏洞防范-3" class="headerlink" title="漏洞防范"></a>漏洞防范</h5><p>采用参数白名单过滤，这里的白名单并不是说完全固定为参数，可以结合正则表达式来进行白名单限制。</p>
<h4 id="命令执行漏洞"><a href="#命令执行漏洞" class="headerlink" title="命令执行漏洞"></a>命令执行漏洞</h4><p>代码执行漏洞指的是可以执行PHP脚本代码，而命令执行漏洞指的是可以执行系统或应用指令（如CMD命令或bash命令）的漏洞。PHP的命令执行漏洞主要基于一些函数的参数过滤不严导致，可以执行命令的函数有system()、exec()、shell_exec()、passthru()、pcntl_exec()、popen()、proc_open()这七个函数，另外反引号也可以执行命令，不过实际上这种方式也是调用的shell_exec()函数。PHP命令执行继承了WebServer用户权限，一般该权限都可以向Web目录写文件。</p>
<h5 id="挖掘经验-8"><a href="#挖掘经验-8" class="headerlink" title="挖掘经验"></a>挖掘经验</h5><p>该漏洞多出现在包含环境包的应用里，一般这类产品会有额外的脚本来协助处理日志及数据库等，web应用会有比较多的点之间使用system()、exec()、shell_exec()、passthru()、pcntl_exec()、popen()、proc_open()等函数执行系统命令来调用这些脚本，可以直接在代码中搜索这几个函数，收获应该会不少。除了这类应用，还有一些调用外部程序的功能也会出命令执行漏洞，由于特征明显，可以直接搜索函数名进行挖掘。</p>
<h6 id="命令执行函数"><a href="#命令执行函数" class="headerlink" title="命令执行函数"></a>命令执行函数</h6><p>上述的函数中，sustem()、exec()、shell_exec()、passthru()以及反引号是可以直接传入命令并返回执行结果。<br>popen()、proc_open()函数不会直接返回执行结果，而是返回一个文件指针。</p>
<h6 id="反引号命令执行"><a href="#反引号命令执行" class="headerlink" title="反引号命令执行"></a>反引号命令执行</h6><p>反引号执行命令是调用的shell_exec()函数。</p>
<h5 id="漏洞防范-4"><a href="#漏洞防范-4" class="headerlink" title="漏洞防范"></a>漏洞防范</h5><ol>
<li>使用PHP自带的命令防注入函数，包括escapeshellcmd()（过滤整条命令）和escapeshellarg()（保证传入命令执行函数的参数确实是以字符串参数形式存在，不能被注入）。</li>
<li>对命令执行函数的参数做白名单限制。（通用修复方法）</li>
</ol>
<h3 id="漏洞挖掘与防范（深入篇）"><a href="#漏洞挖掘与防范（深入篇）" class="headerlink" title="漏洞挖掘与防范（深入篇）"></a>漏洞挖掘与防范（深入篇）</h3><h4 id="变量覆盖漏洞"><a href="#变量覆盖漏洞" class="headerlink" title="变量覆盖漏洞"></a>变量覆盖漏洞</h4><p>变量覆盖指的是可以用我们自定义的参数值替换程序原有的变量值，通常需要结合程序的其它功能来实现完整攻击。<br>该类漏洞大多由函数使用不当导致，常引发漏洞的函数有：extract()函数和parse_str()，import_request_variables()函数则是用于未开启全局变量注册时，调用该函数相当于开启了全局变量注册，在PHP5.4后该函数已经被取消。另外部分应用利用$$的方式注册变量没验证已有变量导致覆盖，这些应用在使用外部传递进来的参数时不是用类似于<code>$_GET[&#39;key&#39;]</code>这样原始的数组变量，而是把里面的key注册成一个变量$key，注册过程中没有验证该变量是否已经存在，所以会导致变量覆盖。</p>
<h5 id="挖掘经验-9"><a href="#挖掘经验-9" class="headerlink" title="挖掘经验"></a>挖掘经验</h5><p>由于变量覆盖漏洞通常要结合其他功能代码来实现完整攻击，所以挖掘可用的变量覆盖漏洞还要考虑究竟哪些变量可以被覆盖并且后面有被使用。<br>由函数导致的变量覆盖比较好挖掘，寻找参数带有变量的extract()、parse_str()函数，回溯变量是否可控。import_request_variables()则只需要找没有初始化且操作前没有赋值的变量，就可以大胆的提交该变量作为参数，另外只要写在该函数前的变量，不管是否已经初始化都可以覆盖，不过该函数只在PHP4-4.1.0以及5-5.4.0可用。<br>关于国内很多程序使用<code>$$</code>符号注册变量会导致变量覆盖，可以直接搜索<code>$$</code>去挖掘，不过建议挖掘前应通读核心文件。</p>
<h6 id="函数使用不当"><a href="#函数使用不当" class="headerlink" title="函数使用不当"></a>函数使用不当</h6><ol>
<li>extract()（最常见）：将数组中的键值对注册成变量，函数结构如下： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int extract (array &amp;$var_array [, int $extract_type &#x3D; EXTR_OVERWRITE [, string $prefix &#x3D; NULL]])</span><br></pre></td></tr></table></figure>
 该函数有3种可能会覆盖已有变量，第一种是第二个参数为EXTR_OVERWRITE，它表示如果有冲突，则覆盖已有变量；第二种是只传入第一个参数，默认为EXTR_OVERWRITE模式；第三种则是第二个参数为EXTR_IF_EXISTS，表示仅在当前符号表中已有同名变量时，覆盖它们的值，其它的都不注册新变量。</li>
<li>parse_str()：解析字符串并注册成变量，在注册变量前不会验证当前变量是否已经存在，所以会直接覆盖掉已有变量。该函数有两个参数： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void parse_str(string $str [, array &amp;$arr])</span><br></pre></td></tr></table></figure>
 其中<code>$str</code>是必须的，代表要解析注册成变量的字符串，形式为<code>a=1</code>，经过函数后会注册变量$a并赋值1。第二个参数$arr是一个数组，当第二个参数存在时，注册的变量会放在这个数组内，但如果该数组内原先就存在相同的键（key），则会覆盖原有键值。</li>
<li>import_request_variables()：作用是把GET、POST、COOKIE的参数注册成变量，用在register_globals被禁止的时候，需要PHP4.1-5.4之间的版本。不过建议不开globals的时候也不要使用该函数，容易造成变量覆盖。</li>
</ol>
<h6 id="变量覆盖"><a href="#变量覆盖" class="headerlink" title="$$变量覆盖"></a>$$变量覆盖</h6><p>由于双$导致原变量被覆盖，在漏洞代码之前的变量都可以被覆盖。</p>
<h5 id="漏洞防范-5"><a href="#漏洞防范-5" class="headerlink" title="漏洞防范"></a>漏洞防范</h5><p>最常见漏洞点是做变量注册以及赋值给变量的时候没有验证变量是否存在，所以推荐使用原始的变量数组，如<code>$_GET</code>、<code>$_POST</code>，或者在注册变量前一定要验证变量是否存在。</p>
<h6 id="使用原始变量"><a href="#使用原始变量" class="headerlink" title="使用原始变量"></a>使用原始变量</h6><p>由于上述变量覆盖漏洞是在进行变量注册时导致，所以要解决变量覆盖的问题，最直接的方法就是不进行变量注册，直接使用原生的<code>$_GET</code>、<code>$_POST</code>等数组变量进行操作，如果考虑到程序可读性等原因，需要注册个别变量，可以直接在代码中定义变量，然后再把请求中的值赋值给它。</p>
<h6 id="验证变量存在"><a href="#验证变量存在" class="headerlink" title="验证变量存在"></a>验证变量存在</h6><p>如果一定要用前面几种方式注册变量，可以在注册变量前先判断变量是否存在，如使用extract()函数则可以配置第二个参数为EXTR_SKIP。使用parse_str()函数注册变量钱需要自行通过代码判断变量是否存在。不建议使用import_request_variables()注册全局变量，会导致变量不可控。最重要的，自行申明的变量一定要初始化，不然即便注册在执行代码前也能被覆盖。</p>
<h4 id="逻辑处理漏洞"><a href="#逻辑处理漏洞" class="headerlink" title="逻辑处理漏洞"></a>逻辑处理漏洞</h4><p>此次指程序在业务逻辑上的漏洞。</p>
<h5 id="挖掘经验-10"><a href="#挖掘经验-10" class="headerlink" title="挖掘经验"></a>挖掘经验</h5><p>漏洞大多存在于逻辑处理及业务流程中，没有特别明显的关键字用于快速定位，挖掘技巧通常是通读功能点源码，熟悉业务流程，可关注程序是否可重复安装、修改密码处是否可越权修改其它用户密码、找回密码验证码是否可暴力破解以及修改其它用户密码、cookie是否可预测或cookie验证是否可绕过等。</p>
<h6 id="等于与存在判断绕过"><a href="#等于与存在判断绕过" class="headerlink" title="等于与存在判断绕过"></a>等于与存在判断绕过</h6><p>判断函数存在漏洞时，可以逃逸判断函数绕过逻辑。常见存在漏洞的判断函数有：</p>
<ol>
<li>in_array()：用于判断一个值是否在某个数组列表里，该函数存在一个问题，比较前会自动做类型转换，实现输入参数并不全等于数组任意值时，也可以实现绕过并注入。</li>
<li>is_numeric()：用于判断一个变量是否为数字，检查通过返回true，否则返回false。该函数存在一个问题，当传入参数为hex时则直接通过并返回true，而mysql是可以直接使用hex编码代替字符串名为的。所以这里虽然不能直接注入SQL语句，但存在二次注入和XSS等漏洞隐患，比如当我们提交<code>&lt;script&gt;alert(1)&lt;/script&gt;</code>的hex编码时，效果相同。如果程序有其它地方调用该值并直接输出，则有可能执行代码触发XSS漏洞。</li>
<li>双等于和三等于：双等于在判断等于前会先做变量类型转换，三等于则不会，所以双等于存在安全风险。</li>
</ol>
<h6 id="账户体系中的越权漏洞"><a href="#账户体系中的越权漏洞" class="headerlink" title="账户体系中的越权漏洞"></a>账户体系中的越权漏洞</h6><p>漏洞分为水平越权和垂直越权，但漏洞原理相同，都是账户体系在判断权限时不严格导致存在绕过漏洞。这一类绕过通常发生在cookie验证不严、简单判断用户提交的参数，归根结底，都是因为参数在客户端提交，服务端未严格校验。</p>
<h6 id="未exit或return引发的安全问题"><a href="#未exit或return引发的安全问题" class="headerlink" title="未exit或return引发的安全问题"></a>未exit或return引发的安全问题</h6><p>某些情况下，在经过if条件判断之后，要么继续执行if后面的代码，要么在if流程内退出当前操作，但该退出行为，有不少程序忘记写return、die()、或者exit()，导致程序继续执行。</p>
<h6 id="常见支付漏洞"><a href="#常见支付漏洞" class="headerlink" title="常见支付漏洞"></a>常见支付漏洞</h6><p>最常见支付漏洞有四种，第1、2、3种比较简单，分别是客户端可修改单价、总价和购买数量，服务器端未严格校验导致。部分商城程序是直接由单价和数量计算总价，但并没有验证这两个数字是否小于0。这种形式的支付漏洞，可以通过寻找支付代码并看代码过滤情况挖掘。<br>还有一种是以重复发包来利用时间差，少量钱多次购买，如使用手机给腾讯发送购买QQ业务的短信再快速取消。这类漏洞可从判断余额及扣费功能代码处寻找。</p>
<h5 id="漏洞防范-6"><a href="#漏洞防范-6" class="headerlink" title="漏洞防范"></a>漏洞防范</h5><ol>
<li>深入熟悉业务逻辑。</li>
<li>多熟悉函数的功能和差异。</li>
</ol>
<h4 id="会话认证漏洞"><a href="#会话认证漏洞" class="headerlink" title="会话认证漏洞"></a>会话认证漏洞</h4><h5 id="挖掘经验-11"><a href="#挖掘经验-11" class="headerlink" title="挖掘经验"></a>挖掘经验</h5><p>在cookie验证上出现几率较高，通常是没有使用session认证，而是将用户信息直接保存在cookie中，以备程序使用时直接调用。一般这个过程都会有一个统一的函数去调用数据，容易导致SQL注入和越权等漏洞。在挖掘登录认证漏洞时，可以先看程序的登录功能代码，看整个登录过程的业务逻辑有没有可以控制session值或直接绕过密码验证的漏洞；另外需要关注程序验证是否为登录的代码，通俗的说是验证cookie的代码，是不是直接取cookie的值，然后如何判断这个值来验证是否登录。</p>
<h6 id="cookie认证安全"><a href="#cookie认证安全" class="headerlink" title="cookie认证安全"></a>cookie认证安全</h6><p>cookie可以保存任何字符串，各个浏览器保存cookie字节数大小不一样，一般不超过4096个字节，通常用于保存登录帐号的标识信息。cookie出现问题较多的是cookie的SQL注入等常见漏洞，以及web应用程序在服务端直接读取cookie值来操作当前用户数据，由于cookie可以伪造，从而导致伪造用户身份登录的漏洞。</p>
<h5 id="漏洞防范-7"><a href="#漏洞防范-7" class="headerlink" title="漏洞防范"></a>漏洞防范</h5><p>了解认证的业务逻辑，严格限制输入的异常字符以及避免直接使用客户端提交的内容进行操作。应该结合cookie和session，不能直接从cookie获取参数值进行操作，另外注意设置session时，需要保证客户端不能操作敏感session参数。特别注意敏感数据不要放在cookie中，cookie在浏览器端以及传输过程中都有被窃取的可能性。</p>
<h3 id="二次漏洞审计"><a href="#二次漏洞审计" class="headerlink" title="二次漏洞审计"></a>二次漏洞审计</h3><h4 id="什么是二次漏洞"><a href="#什么是二次漏洞" class="headerlink" title="什么是二次漏洞"></a>什么是二次漏洞</h4><p>需要先构造好利用代码写入网站保存，在第二次或多次请求后调用攻击代码触发或修改配置触发的漏洞叫做二次漏洞。该漏洞的出现归根结底是开发者在可信数据的逻辑上考虑不全面。</p>
<h4 id="二次漏洞审计技巧"><a href="#二次漏洞审计技巧" class="headerlink" title="二次漏洞审计技巧"></a>二次漏洞审计技巧</h4><p>虽然二次漏洞写入和触发payload很可能不在同一个地方，但还是可以通过找相关关键字去定位的，只是精准度会稍微降低。大多数二次漏洞的逻辑性比一般的漏洞强的多，所以最好还是把全部代码读一遍，更好的了解业务逻辑和全局配置。<br>业务逻辑越复杂的地方越容易出现二次漏洞，我们可以重点关注购物车、订单、引用数据、文章编辑、草稿等和数据库交互的地方，以及和文件系统交互的系统配置文件（一般需要管理员权限才能操作）。<br>在二次漏洞类型里，可以重点关注SQL注入、XSS。</p>
<h3 id="代码审计小技巧"><a href="#代码审计小技巧" class="headerlink" title="代码审计小技巧"></a>代码审计小技巧</h3><h4 id="钻GPC等转义的空子"><a href="#钻GPC等转义的空子" class="headerlink" title="钻GPC等转义的空子"></a>钻GPC等转义的空子</h4><p>GPC会自动把提交内容的敏感字符转义导致攻击代码无法执行，但还是存在漏洞：</p>
<h5 id="SERVER变量"><a href="#SERVER变量" class="headerlink" title="$_SERVER变量"></a>$_SERVER变量</h5><p>在PHP5后，用<code>$_SERVER</code>取到的<code>header</code>字段不受GPC影响，且普通程序员很少会考虑到这些字段。<code>header</code>注入里常见的是<code>user-agent</code>、<code>referer</code>以及<code>client-ip/x-forward-for</code>，因为大多数Web应用都会记录访问者的IP以及<code>referer</code>等信息，同样的<code>$_FILES</code>变量也不受GPC保护。</p>
<h5 id="编码转换问题"><a href="#编码转换问题" class="headerlink" title="编码转换问题"></a>编码转换问题</h5><p>宽字节注入就是一种非常典型的编码转换问题导致绕过GPC的方式。不仅是PHP与MySQL交互过程中会发生编码转换导致问题，PHP自带的编码转换函数也会发生问题，比如mb_convert_encoding()、iconv()，也就是只要发生编码转换就有可能会出现问题。</p>
<h4 id="神奇的字符串"><a href="#神奇的字符串" class="headerlink" title="神奇的字符串"></a>神奇的字符串</h4><h5 id="字符处理函数报错信息泄漏"><a href="#字符处理函数报错信息泄漏" class="headerlink" title="字符处理函数报错信息泄漏"></a>字符处理函数报错信息泄漏</h5><p>页面的报错信息通常能泄漏文件绝对路径、代码、变量及函数等信息，页面报错有很多情况，但不是所有情况页面都会出现错误信息，显示错误信息需要在PHP配置文件中打开并设置等级。<br>大多数错误提示会显示文件路径，可以获取Web路径。由于用户提交数据在后端大多是以字符串方式处理，所以利用字符串处理函数报错成了必不可少的方法，对于利用参数来报错的方式，给函数传入不同类型的变量是最实用的方式。</p>
<h5 id="字符串截断"><a href="#字符串截断" class="headerlink" title="字符串截断"></a>字符串截断</h5><p>截断利用最多的是在文件操作上面，通常用来利用文件包含漏洞和文件上传漏洞，<code>%00</code>即NULL会被GPC和addslashes()过滤掉，所以利用<code>%00</code>截断需要GPC关闭以及不被addslashes()函数过滤，另外PHP5.3之后也不能用这种方式截断。</p>
<ol>
<li>iconv字符编码转换截断：如从UTF-8转换到GBK，部分代码不能被成功转换（chr(128)-chr(255)之间），在利用该函数转码时，遇到不能处理的字符串时后续字符串不会被处理。</li>
</ol>
<h4 id="php-输入输出流"><a href="#php-输入输出流" class="headerlink" title="php://输入输出流"></a>php://输入输出流</h4><h4 id="PHP代码解析标签"><a href="#PHP代码解析标签" class="headerlink" title="PHP代码解析标签"></a>PHP代码解析标签</h4><ol>
<li>最标准的<code>&lt;?php?&gt;</code></li>
<li>脚本标签：<code>&lt;script language=&quot;php&quot;&gt;&lt;/script&gt;</code>，可以正常解析PHP代码</li>
<li>短标签：<code>&lt;?...?&gt;</code>，使用短标签需要在php.ini中设置short_open_tag=on，默认为on状态。</li>
<li>asp标签<code>&lt;%...%&gt;</code>，在PHP3.0.4后可用，需要在php.ini中设置asp_tags=on，默认为off。<br>通常用于绕过<code>&lt;?php?&gt;</code>标签过滤以留后门及绕过Web程序或waf写入webshell。</li>
</ol>
<h4 id="fuzz漏洞发现"><a href="#fuzz漏洞发现" class="headerlink" title="fuzz漏洞发现"></a>fuzz漏洞发现</h4><h4 id="不严谨的正则表达式"><a href="#不严谨的正则表达式" class="headerlink" title="不严谨的正则表达式"></a>不严谨的正则表达式</h4><ol>
<li>没有用<code>^</code>和<code>$</code>限定匹配开始位置</li>
<li>特殊字符未转义，匹配特殊字符的原字符时需要使用反斜杠<code>\</code>来进行转义，不然<code>.</code>则可以用来表示任何字符，存在安全隐患。</li>
</ol>
<h4 id="十余种MySQL报错注入"><a href="#十余种MySQL报错注入" class="headerlink" title="十余种MySQL报错注入"></a>十余种MySQL报错注入</h4><p>利用报错注入最快拿到注入的数据。</p>
<ol>
<li>floor():<code>id=1 and (select 1 from (select count(*),concat(user(),floor(rand(0)*2))x from information_schema.tables group by x)a)</code></li>
<li>extractvalue():<code>id=1 and (extractvalue(1, concat(0x5c, (select user()))))</code></li>
<li>updatexml():<code>id=1 AND (updatexml(1,concat(0x5e24,(select user()),0x5e24),1))</code></li>
<li>GeometryCollection():<code>id=1 AND GeometryCollection((select * from(select * from(select user())a)b))</code></li>
<li>polygon():<code>id=1 AND polygon((select * from(select * from(select user())a)b))</code></li>
<li>multipoint():<code>id=1 AND multipoint((select * from(select * from(select user())a)b))</code></li>
<li>multilinestring():<code>id=1 AND multilinestring((select * from(select * from(select user())a)b))</code></li>
<li>multipolygon():<code>id=1 AND multipolygon((select * from(select * from(select user())a)b))</code></li>
<li>linestring():<code>id=1 AND linestring((select * from(select * from(select user())a)b))</code></li>
<li>exp():<code>id=1 and EXP(~(select * from(select user())a))</code></li>
</ol>
<h4 id="Windows-FindFirstFile"><a href="#Windows-FindFirstFile" class="headerlink" title="Windows FindFirstFile"></a>Windows FindFirstFile</h4><p>目前大多数程序会对上传文件名加密，这样我们就无法直接得到上传webshell文件路径，但在windows下时，我们只需要知道文件所在目录，利用win特性就可以访问文件，因为win在搜索文件时使用了FindFirstFile这一个winapi函数去一个文件夹（包括子文件夹）去搜索指定文件。<br>利用方法很简单，只需要将文件名不可知部分之后的字符用<code>&lt;</code>或<code>&gt;</code>代替即可，不过要注意，只使用一个<code>&lt;</code>或<code>&gt;</code>则只能代表一个字符，如果文件名是12345或更长，请求<code>1&lt;</code>或<code>1&gt;</code>都访问不到文件，需要<code>1&lt;&lt;</code>才能访问到，代表继续往下搜索，有点像win的短文件名。<br>目前所有PHP版本都可用，PHP并没有在语言层面禁止使用<code>&lt;&gt;</code>这些特殊字符，从函数层面来讲，可以利用这个特性的函数有：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">include() include_once() require() require_once()</span><br><span class="line">fopen() ziparchive::open()</span><br><span class="line">copy()</span><br><span class="line">file_get_contents() parse_ini_file() readfile()</span><br><span class="line">file_put_contents()</span><br><span class="line">mkdir()</span><br><span class="line">tempnam() touch()</span><br><span class="line">move_uploaded_file()</span><br><span class="line">opendir() readdir() rewinddir() closedir()</span><br></pre></td></tr></table></figure>

<h4 id="PHP可变变量"><a href="#PHP可变变量" class="headerlink" title="PHP可变变量"></a>PHP可变变量</h4><p>部分PHP应用在写配置文件或使用preg_replace()函数第二个参数赋值变量时，会用到双引号来代表string类型给变量赋值，存在代码执行漏洞。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$a&#x3D;&quot;$&#123;@phpinfo()&#125;&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>注意，上述代码中的<code>@</code>是必须存在的，不然代码无法执行，但除了该符号外还有其它写法，只要不影响PHP规范就可以执行，举例：</p>
<ol>
<li>花括号内第一个字符为空格：<code>$a = &quot;$&#123; phpinfo()&#125;&quot;;</code></li>
<li>花括号内第一个字符为TAB：<code>$a = &quot;$&#123;  phpinfo()&#125;&quot;;</code></li>
<li>花括号内第一个字符为注释符：<code>$a = &quot;$&#123;/**/phpinfo()&#125;&quot;;</code></li>
<li>花括号内第一个字符为回车换行符：<code>$a = &quot;$&#123; phpinfo()&#125;&quot;;</code></li>
<li>花括号内第一个字符为加号：<code>$a = &quot;$&#123;+phpinfo()&#125;&quot;;</code></li>
<li>花括号内第一个字符为减号：<code>$a = &quot;$&#123;-phpinfo()&#125;&quot;;</code></li>
<li>花括号内第一个字符为感叹号：<code>$a = &quot;$&#123;!phpinfo()&#125;&quot;;</code><br>除此之外还有一些如<code>~</code>、<code>\</code>等。</li>
</ol>
<h2 id="PHP安全编程规范"><a href="#PHP安全编程规范" class="headerlink" title="PHP安全编程规范"></a>PHP安全编程规范</h2><h3 id="参数的安全过滤"><a href="#参数的安全过滤" class="headerlink" title="参数的安全过滤"></a>参数的安全过滤</h3><h4 id="第三方过滤函数与类"><a href="#第三方过滤函数与类" class="headerlink" title="第三方过滤函数与类"></a>第三方过滤函数与类</h4><p>目前大多数程序都有一个统一的参数过滤入口，但对于特定场景和漏洞就不够好用。所以除了总入口，在具体功能点也需要进行过滤。</p>
<h4 id="内置过滤函数"><a href="#内置过滤函数" class="headerlink" title="内置过滤函数"></a>内置过滤函数</h4><ol>
<li>SQL注入过滤函数：有addslashes()、mysql_real_escape_string()以及mysql_escape_string()，作用都是给字符串添加反斜杠<code>\</code>来转义掉单引号、双引号、反斜杠以及空字符NULL。addslashes()和mysql_escape_string()都是直接在敏感字符串前加反斜杠，可能会存在宽字节注入绕过的问题，而mysql_real_escape_string()会考虑当前连接数据库的字符集编码，更加安全。</li>
<li>XSS过滤函数：有htmlspecialchars()和strip_tags()，功能不同，htmlspecialchars作用是将字符串中的特殊字符转换成HTML实体编码，能够干掉大多数的XSS攻击。strip_tags则是用来去掉HTML及PHP标记。</li>
<li>命令执行过滤函数：有escapeshellcmd()和escapeshellarg()两个函数，escapeshellcmd过滤的字符为下方代码框所示，win下过滤方式则是在这些字符前面加了<code>^</code>符号，linux下则是在这些字符前加了反斜杠。escapeshellarg函数过滤较简单，给所有参数加上一对双引号，强制为字符串。 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;,;,&#96;,|,*,?,~,&lt;,&gt;,^,(,),[,],&#123;,&#125;,$,\,\x0A,\xFF,% 以及单双引号</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="使用安全的加密算法"><a href="#使用安全的加密算法" class="headerlink" title="使用安全的加密算法"></a>使用安全的加密算法</h3><ol>
<li>对称加密：算法安全性比较高，数据的实际安全性取决于密钥的管理。所以不建议使用对称加密对用户密码进行加密存储。</li>
<li>非对称加密：安全性比对称加密更好。</li>
<li>单向加密：不可逆算法，常见如MD系列和sha1，通常用于保存密码和做数字签名，但存在碰撞的问题。</li>
</ol>
<h3 id="业务功能安全设计"><a href="#业务功能安全设计" class="headerlink" title="业务功能安全设计"></a>业务功能安全设计</h3><h4 id="验证码"><a href="#验证码" class="headerlink" title="验证码"></a>验证码</h4><h5 id="验证码绕过"><a href="#验证码绕过" class="headerlink" title="验证码绕过"></a>验证码绕过</h5><ol>
<li>不刷新直接绕过：后端接收一次请求后并没有主动刷新验证码，将验证码和session绑定在一起，为了保证验证码正常使用，会把验证码明文或加密后放在Cookie或POST数据包里，所以每次只要同一个数据包里的两个验证码对应即可绕过。（重复发包利用？）</li>
<li>暴力破解：验证码能够被爆破，主要是程序没有设置验证码错误次数和超时设定，导致能够不断尝试。</li>
<li>机器识别：利用机器识别验证码。</li>
<li>打码平台：人工打码绕过。</li>
</ol>
<h6 id="对策"><a href="#对策" class="headerlink" title="对策"></a>对策</h6><ol>
<li>设置验证码错误次数（最重要）。</li>
<li>不把验证码放在HTML页面或cookie中。</li>
<li>验证码设置只能请求一次，请求一次后不管错误与否都在后端程序强制刷新。</li>
<li>短信或邮件验证码必须要6位以上字母和数字混合，图片或语音验证码需要加强混淆干扰。（短信验证码这条似乎在当前不适用，多数厂商选择限制短时间同IP发包等，但不增加验证码复杂度）</li>
<li>验证码要动态生成，不能统一生成多次调用。</li>
</ol>
<h5 id="验证码资源滥用"><a href="#验证码资源滥用" class="headerlink" title="验证码资源滥用"></a>验证码资源滥用</h5><p>利用大量网站短信验证码未限制获取验证码次数和时间间隔的接口，实现短信/邮箱轰炸。防护比较简单，限制单个手机号在一个时间段内请求接收短信的次数，或限制某一IP在一个时间段内请求接收短信的次数。</p>
<h4 id="用户登录"><a href="#用户登录" class="headerlink" title="用户登录"></a>用户登录</h4><h5 id="撞库登录"><a href="#撞库登录" class="headerlink" title="撞库登录"></a>撞库登录</h5><p>指登录口没有做登录次数限制，导致可以使用不同的用户及密码不断进行登录尝试，遍历用户密码。撞库漏洞情况有：</p>
<ol>
<li>用户名和密码错误次数都无限制。</li>
<li>单时间段内用户密码错误次数限制。（可以使用单密码和用户名列表撞库）</li>
<li>单时间段内IP登录错误次数限制。（存在误杀内网用户的可能）<br>比较好的解决方案是使用登录验证码和多因素认证。</li>
</ol>
<h5 id="API登录"><a href="#API登录" class="headerlink" title="API登录"></a>API登录</h5><p>免重新登录跳转处存在漏洞，如修改用户参数实现任意登录。对于这种漏洞注意以下安全点：</p>
<ol>
<li>登录密钥（clientkey）需要不可预测且不固定，生成key的算法中加入随机字符。</li>
<li>API接口禁止搜索引擎收录。</li>
<li>登录密钥当次绑定当前主机，换机器不可用，防止木马和嗅探。</li>
</ol>
<h4 id="用户注册"><a href="#用户注册" class="headerlink" title="用户注册"></a>用户注册</h4><ol>
<li>设计验证码。</li>
<li>采集用户机器唯一识别码，拦截短时间内多次注册。</li>
<li>根据帐号格式自学习识别垃圾帐号。</li>
<li>防止SQL注入漏洞与XSS漏洞（常见）。</li>
</ol>
<h4 id="密码找回"><a href="#密码找回" class="headerlink" title="密码找回"></a>密码找回</h4><ol>
<li>输入用户名/邮箱/手机阶段：抓包修改手机/邮箱参数。</li>
<li>填写验证码和新密码阶段：<ul>
<li>验证凭证简单，可以被暴力破解。</li>
<li>验证凭证算法简单，凭证可以被预测。</li>
<li>验证凭证直接保存在源码里。</li>
</ul>
</li>
<li>发送新密码阶段：<br>凭证未绑定用户：请求发送至邮箱的找回密码链接时，后端根据uid和key对应判断该链接有效，但将新密码提交到服务器时，服务器端没有判断当前key是否和uid或邮箱匹配，直接修改掉uid或邮箱指定的用户密码。这样只要拦截修改密码的请求包，篡改用户参数即可。所以安全风险点应该注意的有：<ul>
<li>接收验证码的邮箱和手机号不可由用户控制，应直接从数据库读取。</li>
<li>加强验证凭证复杂度，防止被暴力破解。</li>
<li>限制验证凭证错误次数，单用户在一定时间内验证码错误一定次数，强制等待一段时间。</li>
<li>验证凭证设置失效时间。</li>
<li>验证凭证不要保存在页面。</li>
<li>输入用户邮箱或ID、手机号取验证凭证的地方需要设置验证码防止短信炸弹和批量找回等。</li>
<li>验证凭证跟用户名、用户ID、用户邮箱绑定，找回密码时验证当前凭证是否是当前用户的。</li>
</ul>
</li>
</ol>
<h4 id="资料查看和修改"><a href="#资料查看和修改" class="headerlink" title="资料查看和修改"></a>资料查看和修改</h4><p>这里主要介绍的是越权漏洞的利用。</p>
<ol>
<li>未验证用户权限：直接修改当前资源ID即可访问该资源，没有验证当前资源是否属于当前用户。</li>
<li>未验证当前登录用户：虽然程序绑定了用户ID和资源ID，但该用户ID是访问资源时直接从cookie或post、get参数里获取，所以可以通过修改成另一用户ID，利用其权限操作资源。<br>上述漏洞较多出现在用户资料修改，及用户资料查看。<br>防御思路有：</li>
</ol>
<ul>
<li>用户资源ID（订单ID、地址ID等）绑定到用户，只允许有权限的用户查看。</li>
<li>当前用户信息存储到session，不放在request中，避免攻击者修改。</li>
</ul>
<h4 id="投票-积分-抽奖"><a href="#投票-积分-抽奖" class="headerlink" title="投票/积分/抽奖"></a>投票/积分/抽奖</h4><p>共同点：<code>单个用户次数存在限制</code>，该限制存在很多绕过方式。<br>通常有几种利用方法：</p>
<ol>
<li>cookie或POST请求正文绕过。修改cookie或post请求数据产生绕过。</li>
<li>基于IP验证。看程序获取IP的方式，如果是client-ip或x_forward_for获取IP，可直接伪造IP绕过。</li>
<li>基于用户认证。利用批量注册刷票，或在投票时随意修改POST包或cookie里的当前uid、用户名等查看是否能够绕过限制。<br>从上述利用手段可以看到主要三个点是IP、登录用户、cookie，可用性比较高的防御手段如下：</li>
<li>机器识别码验证。</li>
<li>操作需要登录，当前用户信息从session读取。</li>
</ol>
<h4 id="充值支付"><a href="#充值支付" class="headerlink" title="充值支付"></a>充值支付</h4><p>主要有四种情况：客户端可修改单价、总价和购买数量以及利用时间差多次购买。<br>主要应对手法是：</p>
<ol>
<li>保证数据可信，商品单价和总价不可从客户端获取。</li>
<li>购买数量不能小于等于0。</li>
<li>账户支付锁定机制，当一个支付操作开始就应该立马锁定当前用户，不能同时两个后端请求对余额进行操作。</li>
</ol>
<h4 id="私信及反馈"><a href="#私信及反馈" class="headerlink" title="私信及反馈"></a>私信及反馈</h4><p>除去特殊情况下可以滤去的SQL注入或命令执行等少见漏洞外，最常见的就是XSS漏洞以及越权漏洞。</p>
<h4 id="远程地址访问"><a href="#远程地址访问" class="headerlink" title="远程地址访问"></a>远程地址访问</h4><p>访问远程地址获取资源的功能可能会被利用（如填入内网地址）<br>利用限制填写来防御该类漏洞，但大部分厂商修复时不会考虑到短地址的问题，修复后仍然可以通过生成短链接的方式利用。</p>
<h4 id="文件管理"><a href="#文件管理" class="headerlink" title="文件管理"></a>文件管理</h4><p>本身就是一个高危功能，权限管理不当会导致被攻击者利用写入webshell。<br>为了保证安全，在满足业务需求的情况下，设计时应遵循以下几点：</p>
<ol>
<li>禁止写入脚本可在服务器端执行的文件：如服务器可解析PHP，那么此次就需要限制不能操作PHP扩展名的文件和PHP标签的代码。</li>
<li>限制文件管理功能操作的目录：限制文件管理功能只能操作固定目录，目录不能从客户端提交，在代码中设置好即可，如果实在需要进行目录跳转的话，一定要禁止提交<code>../</code>以及<code>\..</code>避免越权操作其它目录。</li>
<li>限制文件管理功能访问权限：虽然文件管理是正常功能，但存在一点后门的性质，所以对该功能的访问权限一定要严格控制。</li>
<li>禁止上传特殊字符文件名的文件：大多数应用会对上传文件进行展示，特别是网盘类应用，注意对上传文件名进行检查，禁止文件名中有尖括号、单双引号等特殊字符，避免攻击者用文件名进行XSS攻击。</li>
</ol>
<h4 id="数据库管理"><a href="#数据库管理" class="headerlink" title="数据库管理"></a>数据库管理</h4><p>跟文件管理一样，也是高位功能，如果启动数据库服务的系统用户以及数据库用户的权限都够大，完全可以利用该功能直接执行系统命令及操作服务器上的文件。</p>
<ol>
<li>限制可以操作的数据库表，要么在代码内写死只能操作哪些表（如备份），如果是执行SQL语句的方式可以另建一个mysql用户，限制可操作的表和字段。</li>
<li>限制备份到服务器上的文件名，需要随机生成且长度不低于16位，扩展名不能自定义，防止攻击者利用该功能导出webshell或猜解文件名直接下载。</li>
</ol>
<h4 id="命令-代码执行"><a href="#命令-代码执行" class="headerlink" title="命令/代码执行"></a>命令/代码执行</h4><p>命令执行和代码执行功能通常都在系统后台，相比来说，命令执行的功能使用更多，代码执行功能在特殊应用上才会存在。设计该类功能时应该注意以下几点：</p>
<ol>
<li>严格控制该功能访问权限，建议高权限才能访问。</li>
<li>在满足业务需求的情况下，可以设置命令白名单，可以使用escapeshellcmd()以及escapeshellarg()函数进行过滤，命令直接写死在代码中更好。</li>
<li>给命令及代码执行功能设置独立密码。</li>
<li>代码执行功能限制脚本可访问的路径。</li>
<li>在满足需求的情况下限制当前执行命令的系统权限。</li>
</ol>
<h4 id="文件-数据库备份"><a href="#文件-数据库备份" class="headerlink" title="文件/数据库备份"></a>文件/数据库备份</h4><p>是非常常见且非常容易出现安全问题的功能。常见问题有：</p>
<ol>
<li>未授权访问和越权访问：未授权访问体现在这个备份功能直接在不登录或登录验证存在漏洞的情况下可以直接使用，以及存在CSRF漏洞可以直接劫持管理员帐号进行备份。</li>
<li>备份文件名可预测：攻击者可以利用枚举的方式扫描备份包。</li>
<li>生成的文件可利用web中间件解析漏洞执行代码<br>如何设计备份功能：</li>
<li>进行权限控制，只有高权限可以使用。</li>
<li>文件名随机生成，不可预测。</li>
</ol>
<h4 id="API"><a href="#API" class="headerlink" title="API"></a>API</h4><p>因为爬虫无法抓取APP中的API接口，所以接口的SQL注入等漏洞相对较多，目前最多的问题是未授权访问以及数据遍历漏洞。因此设计一个安全的API需要从以下几点考虑：</p>
<ol>
<li>访问权限控制：必要时加入账户体系，严格控制数据调用权限，比如当前用户必须在登录情况下，接口参数中传入自己登录成功的凭证才能调用这个用户的数据。另外不需要账户体系时也要注意加入不可暴力破解的访问密钥进行权限验证。</li>
<li>防止敏感信息泄漏：没必要输出的信息应该注意禁止输出。</li>
<li>SQL注入等常规漏洞：注意代码安全，防止SQL注入、代码执行等漏洞的产生。</li>
</ol>
<h3 id="应用安全体系建设"><a href="#应用安全体系建设" class="headerlink" title="应用安全体系建设"></a>应用安全体系建设</h3><ol>
<li>用户密码安全策略</li>
<li>前后台用户分表：同表的情况下可能存在越权修改管理员信息等情况。</li>
<li>后台地址隐藏</li>
<li>密码加密存储方式</li>
<li>登录限制</li>
<li>API站库分离</li>
<li>慎用第三方服务</li>
<li>严格的权限控制</li>
<li>敏感操作多因素验证</li>
<li>应用自身的安全中心</li>
</ol>

            </div>
        
        <footer class="article-footer">
        </footer>
    </div>
</article>






    
        <article id="post-试玩Game-of-hacks" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
                    <div class="article-meta">
                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link-link" href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" rel="tag">代码审计</a>
    </div>

                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/wiki/%E8%AF%95%E7%8E%A9Game-of-hacks/">
            <time datetime="2021-07-15T08:44:14.000Z" itemprop="datePublished">2021-07-15</time>
        </a>
    </div>


                        
                            <i class="fa fa-bar-chart"></i>
                            <span id="busuanzi_container_site_pv"><span id="busuanzi_value_page_pv"></span></span>    
                        
                        
                            <div class="article-meta-button">
                                <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Tsunamori/Wiki-site/raw/writing/source/_posts/试玩Game-of-hacks.md"> Source </a>
                            </div>
                            <div class="article-meta-button">
                                <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Tsunamori/Wiki-site/edit/writing/source/_posts/试玩Game-of-hacks.md"> Edit </a>
                            </div>
                            <div class="article-meta-button">
                                <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Tsunamori/Wiki-site/commits/writing/source/_posts/试玩Game-of-hacks.md"> History </a>
                            </div>
                        
                    </div>
                
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/wiki/%E8%AF%95%E7%8E%A9Game-of-hacks/">Game of hacks 试玩</a>
        </h1>
    

            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
        
            
        
        
            <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>从Awesome-hacking_Cyber-skills看到的练习网站，粗略看了一下描述是关于代码审计的，正好一直在考虑提升一下代码审计的技能，最近就来试玩一下，顺便记录WP。</p>
<h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><p>一开始有难度选项，分别是beginner、intermediate和advanced。嗯，十分正常的分类。另外要选代码语言，一共十种，我比较在意的Android、Java、PHP、Python、.NET都在，令人满意。<br>看了题目大概是每次随机抽五道题+计时+提供选项，所以WP就先简单记一下代码，最后整理思路。</p>
<h3 id="PHP-代码审计"><a href="#PHP-代码审计" class="headerlink" title="PHP 代码审计"></a>PHP 代码审计</h3><h4 id="Beginner"><a href="#Beginner" class="headerlink" title="Beginner"></a>Beginner</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">int i;</span><br><span class="line">char inLine[64];</span><br><span class="line">cin &gt;&gt; inLine; &#x2F;&#x2F; 将cin的二进制码向右移动inLine位（或将cin十进制除以2 inLine次）,但是在这里没有用到。</span><br><span class="line">i &#x3D; atoi (inLine); &#x2F;&#x2F; atoi()：字符串转换整数</span><br><span class="line">sleep(i);</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Dim myPassWord As String</span><br><span class="line">myPassWord &#x3D; &quot;12345&quot;</span><br></pre></td></tr></table></figure>
<p>use of hardcoded password</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Private Sub cmdRunNotePad_Click()</span><br><span class="line">Dim str As String</span><br><span class="line">MyVar &#x3D; window.Text()</span><br><span class="line">Sleep myVar+1</span><br><span class="line">dblNotePadID &#x3D; Sleep(myVar)</span><br><span class="line">End Sub</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$dn &#x3D; $_GET[&#39;host&#39;];</span><br><span class="line">$filter&#x3D;&quot;(|(sn&#x3D;$person*)(givenname&#x3D;$person*))&quot;;</span><br><span class="line">$justthese &#x3D; array(&quot;ou&quot;, &quot;sn&quot;, &quot;givenname&quot;, &quot;mail&quot;);</span><br><span class="line">$sr&#x3D;ldap_search($ds, $dn, $dn, $justthese);</span><br><span class="line">$info &#x3D; ldap_get_entries($ds, $sr);</span><br><span class="line">echo $info[&quot;count&quot;].&quot; entries returned</span><br><span class="line">&quot;;?&gt;</span><br></pre></td></tr></table></figure>
<p>LDAP injection</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String url &#x3D; req.getRequestURL().toString();</span><br><span class="line">RequestDispatcher disp &#x3D; req.getRequestDispatcher(url.substring(url.lastIndexOf(req.getContextPath() + &quot;&#x2F;&quot;)</span><br><span class="line">+ req.getContextPath().length()));</span><br><span class="line">disp.forward(request, response);</span><br></pre></td></tr></table></figure>

            </div>
        
        <footer class="article-footer">
        </footer>
    </div>
</article>






    
        <article id="post-Notes_0-to-1-the-road-of-CTFer_1" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
                    <div class="article-meta">
                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link-link" href="/tags/CTF/" rel="tag">CTF</a>
    </div>

                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/wiki/Notes_0-to-1-the-road-of-CTFer_1/">
            <time datetime="2021-04-26T05:49:07.000Z" itemprop="datePublished">2021-04-26</time>
        </a>
    </div>


                        
                            <i class="fa fa-bar-chart"></i>
                            <span id="busuanzi_container_site_pv"><span id="busuanzi_value_page_pv"></span></span>    
                        
                        
                            <div class="article-meta-button">
                                <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Tsunamori/Wiki-site/raw/writing/source/_posts/Notes_0-to-1-the-road-of-CTFer_1.md"> Source </a>
                            </div>
                            <div class="article-meta-button">
                                <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Tsunamori/Wiki-site/edit/writing/source/_posts/Notes_0-to-1-the-road-of-CTFer_1.md"> Edit </a>
                            </div>
                            <div class="article-meta-button">
                                <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Tsunamori/Wiki-site/commits/writing/source/_posts/Notes_0-to-1-the-road-of-CTFer_1.md"> History </a>
                            </div>
                        
                    </div>
                
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/wiki/Notes_0-to-1-the-road-of-CTFer_1/">0 to 1 the road of CTFer 第一章 Web入门</a>
        </h1>
    

            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
        
            
        
        
            <h1 id="第一章-Web入门"><a href="#第一章-Web入门" class="headerlink" title="第一章 Web入门"></a>第一章 Web入门</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><h3 id="敏感信息泄漏"><a href="#敏感信息泄漏" class="headerlink" title="敏感信息泄漏"></a>敏感信息泄漏</h3><h4 id="git泄漏"><a href="#git泄漏" class="headerlink" title="git泄漏"></a>git泄漏</h4><ol>
<li>常规git泄漏：flag在源码内，可直接利用工具或脚本获取。</li>
<li>git回滚：flag被修改，但依然保存在commit记录里。<ul>
<li>利用<code>git reset --hard [版本号]</code>获取flag。</li>
<li>更简单的方法是通过<code>git log-stat</code>查看每个commit修改了哪些文件，再用<code>git diff HEAD [commit-id]</code>比较当前版本和想看的commit之间的变化。</li>
</ul>
</li>
<li>git分支：命令<code>git reflog</code>查看分支间切换的记录。从原url下载分支内容并恢复（目前的恢复分支记录需要下载分支HEAD并修改GitHacker.py代码实现自动恢复分支，先简单记录下来，后续看是否有其它更简单的方式。）</li>
<li>git stash：stash是对当前工作的“保存”，以备后续恢复。<code>git stash list</code>查看保存的列表，<code>git stash pop</code>恢复工作现场，<code>git stash show</code>显示做了哪些改动。</li>
<li>git index：index是暂存区，用于通过git add .命令暂存新建文件等待commit。使用<code>git checkout-index</code>命令恢复文件。</li>
<li>git泄漏的其他利用方式：泄漏的git中也可能有其他有用的信息。<ul>
<li>.git/config文件夹中可能含有access_token信息，从而访问该用户的其它仓库。</li>
</ul>
</li>
</ol>
<h4 id="SVN泄漏"><a href="#SVN泄漏" class="headerlink" title="SVN泄漏"></a>SVN泄漏</h4><p>SVN是源代码版本管理软件，如果存在泄漏，可以利用.svn/entries或wc.db文件获取服务器源码等信息。</p>
<ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/kost/dvcs-ripper">https://github.com/kost/dvcs-ripper</a></li>
<li>Seay-svn（Win）</li>
</ul>
<h4 id="HG泄漏"><a href="#HG泄漏" class="headerlink" title="HG泄漏"></a>HG泄漏</h4><p>.hg隐藏文件中包含代码和分支修改记录等信息。</p>
<ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/kost/dvcs-ripper">https://github.com/kost/dvcs-ripper</a></li>
</ul>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>CTF线上赛往往会有重定向的问题，例如，只要访问<code>.git</code>便会返回403,此时访问<code>.git/config</code>，如果有文件内容返回，说明存在git泄漏，反之，一般不存在。而在SVN泄漏中，一般是在entries中爬取源代码，但有时会出现entries为空的情况，这时注意wc.db文件存在与否，便可通过其中的checksum在pristine文件夹中获取源代码。</p>
<h3 id="敏感备份文件"><a href="#敏感备份文件" class="headerlink" title="敏感备份文件"></a>敏感备份文件</h3><h4 id="gedit备份文件"><a href="#gedit备份文件" class="headerlink" title="gedit备份文件"></a>gedit备份文件</h4><p>在Linux下，用gedit编辑器保存文件后，当前目录下会生成一个<code>[文件名]~</code>的备份文件，访问这个文件即可获得文件内容。</p>
<h4 id="vim备份文件"><a href="#vim备份文件" class="headerlink" title="vim备份文件"></a>vim备份文件</h4><p>vim在意外退出时会生成一个备份文件，文件名格式为<code>.filename.swp</code>，再次生成备份文件时则为<code>.filename.swo</code>，第三次为<code>.filename.swn</code>，以此类推。恢复备份的办法是，先在当前目录下创建一个flag文件，再使用<code>vim-r flag</code>，即可恢复.flag.swp。</p>
<h4 id="常规文件"><a href="#常规文件" class="headerlink" title="常规文件"></a>常规文件</h4><p>主要靠丰富字典。(dirsearch+自己收集字典)</p>
<ul>
<li>phpinfo()</li>
<li>备份文件后缀<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">back.rar</span><br><span class="line">back.tar</span><br><span class="line">back.tar.gz</span><br><span class="line">back.zip</span><br><span class="line">backup.rar</span><br><span class="line">backup.tar</span><br><span class="line">backup.tar.gz</span><br><span class="line">backup.zip</span><br><span class="line">temp.rar</span><br><span class="line">temp.tar</span><br><span class="line">temp.tar.gz</span><br><span class="line">temp.zip</span><br><span class="line">web.rar</span><br><span class="line">web.tar</span><br><span class="line">web.tar.gz</span><br><span class="line">web.zip</span><br><span class="line">website.rar</span><br><span class="line">website.tar</span><br><span class="line">website.tar.gz</span><br><span class="line">website.zip</span><br><span class="line">www.rar</span><br><span class="line">www.tar</span><br><span class="line">www.tar.gz</span><br><span class="line">www.zip</span><br><span class="line">wwwroot.rar</span><br><span class="line">wwwroot.tar</span><br><span class="line">wwwroot.tar.gz</span><br><span class="line">wwwroot.zip</span><br><span class="line">index.php.bak</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h4><p>线上赛过程中，出题人往往会在线运维题目，有时会导致swp备份文件的生成。所以读者在比赛过程中可以编写实时监控脚本，对题目服务进行监控。</p>
<h3 id="Banner识别"><a href="#Banner识别" class="headerlink" title="Banner识别"></a>Banner识别</h3><p>在线上赛中，网站的Banner对解题有着十分重要的作用，选手往往可以通过Banner信息来获得解题思路。<br>如得知网站是用ThinkPHP的Web框架编写时，我们可以尝试ThinkPHP框架的相关历史漏洞。或者得知这个网站是Windows服务器，那么我们在测试上传漏洞时可以根据Windows的特性进行尝试。</p>
<h4 id="自行收集指纹库"><a href="#自行收集指纹库" class="headerlink" title="自行收集指纹库"></a>自行收集指纹库</h4><ul>
<li>Github CMS指纹库</li>
<li>扫描器识别</li>
</ul>
<h4 id="使用已有工具"><a href="#使用已有工具" class="headerlink" title="使用已有工具"></a>使用已有工具</h4><ul>
<li>Wappalyzer（pip install python-Wappalyzer）：在data目录下，apps.json是其规则库，读者可以根据自己需求自由添加。</li>
</ul>
<h4 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h4><p>除了以上两种识别方式，我们还可以通过随意输入一些URL，观察404和302跳转页面中是否包含CMS及版本号。</p>
<h2 id="CTF中的SQL注入"><a href="#CTF中的SQL注入" class="headerlink" title="CTF中的SQL注入"></a>CTF中的SQL注入</h2><h3 id="SQL注入（mysql）"><a href="#SQL注入（mysql）" class="headerlink" title="SQL注入（mysql）"></a>SQL注入（mysql）</h3><h4 id="数字型注入"><a href="#数字型注入" class="headerlink" title="数字型注入"></a>数字型注入</h4><p>test.php?id=2 -&gt; true。返回记录。<br>test.php?id=3-1 -&gt; true，返回id=2的记录。<br>说明mysql对3-1进行了计算，从数字运算这个特征可以判断该注入点为数字型注入，输入点$_GET[‘id’]附近没有引号包裹，可以直接输入SQL查询语句。</p>
<p>mysql查询出两行记录（union select联合查询注入）但PHP源码限制只能显示一行记录的办法：<br>    1. 在原有数据后面加上<code>limit 1,1</code>参数，显示查询结果的第二条记录。<br>    1. 指定id=-1或一个很大的值，使第一条数据无法被查询到。（常用）</p>
<h4 id="字符型注入"><a href="#字符型注入" class="headerlink" title="字符型注入"></a>字符型注入</h4><p>与数字型注入相比，只是在GET参数输入的地方包裹了单引号（少部分情况为双引号）让其变成字符串。<br>在MySQL中，等号两边如果类型不一致则会发生强制转换，当数字和字符串数据比较时，字符串将被转换为数字再进行比较。<br>test.php?id=3-2，无返回结果，证明注入点不是数字型。继续尝试test.php?id=2a，返回id=2的结果，证明存在字符型注入。</p>
<pre><code>1. 尝试使用单引号闭合前面的单引号，（插入查询语句），再用`--%20`或`%23`注释后面的语句，注意在URL框输入时，`-- `和`#`以及`&#39;&#39;`要进行URL编码。
1. 除了注释，也可以使用单引号来闭合后面的单引号，eg: test.php?id=2&#39;union select xxx &#39;
</code></pre>
<h4 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h4><p>test.php?id=1’and’f’=’a’，猜中则返回id=1内容<br>更快的方法为 test.php?id=1’and’f’&lt;’n’，二分法。<br>如何获取每一位字符？利用mysql的substring(),mid(),substr()等。</p>
<h4 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h4><p>php?id=1’or sleep(10)</p>
<h4 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h4><p>mysql会将语句执行后的报错信息输出。<br>updatexml在执行时，第二个参数应该为合法的XPATH路径，否则会在引发报错时输出传入的参数。<br>id=’1’ or updatexml(1,concat(0x7e,(select pwd from wp_user)),1)<br>updatexml()报错注入，ref: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://blog.csdn.net/qq_37873738/article/details/88042610">https://blog.csdn.net/qq_37873738/article/details/88042610</a></p>
<h4 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h4><p>当目标开启多语句执行时，可以采用多语句执行的方式修改数据库结构和数据。</p>
<h3 id="注入点"><a href="#注入点" class="headerlink" title="注入点"></a>注入点</h3><h4 id="注入点在select-expr"><a href="#注入点在select-expr" class="headerlink" title="注入点在select_expr"></a>注入点在select_expr</h4><p>AS别名：id=(select%20pwd%20from%20wp_user)%20as%20title</p>
<h4 id="注入点在table-reference"><a href="#注入点在table-reference" class="headerlink" title="注入点在table_reference"></a>注入点在table_reference</h4><p>仍可以用别名取出数据：SELECT title FROM (SELECT pwd AS title FROM wp_user)x;</p>
<p>在该两处的注入，如果注入点有反引号包裹，那么需要先闭合反引号。</p>
<h4 id="注入点在WHERE或HAVING后"><a href="#注入点在WHERE或HAVING后" class="headerlink" title="注入点在WHERE或HAVING后"></a>注入点在WHERE或HAVING后</h4><p>代码：<code>$res = mysqli_query($conn, &quot;SELECT title FROM wp_news WHERE id = $&#123;_GET[id]&#125;&quot;);</code><br>现实中最常遇到的情况，要先判断有无引号包裹，再闭合前面可能存在的括号，即可进行注入来获取数据。</p>
<p>注入点在HAVING后的情况与之类似。</p>
<h4 id="注入点在GROUP-BY或ORDER-BY后"><a href="#注入点在GROUP-BY或ORDER-BY后" class="headerlink" title="注入点在GROUP BY或ORDER BY后"></a>注入点在GROUP BY或ORDER BY后</h4><p>当遇到不是WHERE后的注入点时，先在本地MySQL中进行尝试，看语句后面能加什么，从而判断当前可以注入的位置，进而进行有针对的注入。</p>
<p>假设代码如下：<code>$res = mysqli_query($conn, &quot;SELECT title FROM wp_news GROUP BY $&#123;_GET[&#39;title&#39;]&#125;&quot;);</code><br>测试可得，title=id desc,(if(1,sleep(1),1))，可以利用时间注入获取数据。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">事实上只要对输入值进行白名单比对，基本就能防御这种注入。</span><br></pre></td></tr></table></figure>

<h4 id="注入点在LIMIT后"><a href="#注入点在LIMIT后" class="headerlink" title="注入点在LIMIT后"></a>注入点在LIMIT后</h4><p>该注入比较简单，通过更改数字大小，页面会显示更多或更少的记录数。由于语法限制，LIMIT后只能是数字，在整个SQL语句没有ORDER BY关键字的情况下，可以直接使用UNION注入。另外可以根据SELECT语法，通过加入PROCEDURE来尝试注入（只适用于MySQL 5.6前的版本）</p>
<h3 id="INSERT注入"><a href="#INSERT注入" class="headerlink" title="INSERT注入"></a>INSERT注入</h3><p>通常注入位于字段名或字段值的地方，且没有回显信息。</p>
<h4 id="注入点位于tbl-name"><a href="#注入点位于tbl-name" class="headerlink" title="注入点位于tbl_name"></a>注入点位于tbl_name</h4><p>如果能够通过注释符注释后续语句，则可直接插入特定数据到想要的表内，如管理员表。</p>
<h4 id="注入点位于VALUES"><a href="#注入点位于VALUES" class="headerlink" title="注入点位于VALUES"></a>注入点位于VALUES</h4><h3 id="UPDATE注入"><a href="#UPDATE注入" class="headerlink" title="UPDATE注入"></a>UPDATE注入</h3><h3 id="DELETE注入"><a href="#DELETE注入" class="headerlink" title="DELETE注入"></a>DELETE注入</h3><p>对id参数进行注入时，如果使WHERE后的值变为true，数据就会被删除。为了保证正常数据不会被干扰，通常使用<code>and sleep (1)</code>保证WHERE后的结果返回为false，让语句无法成功执行，后续步骤参考时间盲注。</p>
<h2 id="注入防御及绕过思路"><a href="#注入防御及绕过思路" class="headerlink" title="注入防御及绕过思路"></a>注入防御及绕过思路</h2><p>其它ref：<a target="_blank" rel="external nofollow noopener noreferrer" href="https://blog.csdn.net/wy_97/article/details/78085664">https://blog.csdn.net/wy_97/article/details/78085664</a></p>
<h3 id="关键字替换或匹配拦截"><a href="#关键字替换或匹配拦截" class="headerlink" title="关键字替换或匹配拦截"></a>关键字替换或匹配拦截</h3><h4 id="过滤空格"><a href="#过滤空格" class="headerlink" title="过滤空格"></a>过滤空格</h4><p>替代空格的空白符有：<code>%0a, %0b, %0c, %0d, %09, %a0</code>（均为URL编码，%a0在特定字符集才能利用）和<code>/**/</code>组合、括号等。</p>
<h4 id="将SELECT替换成空"><a href="#将SELECT替换成空" class="headerlink" title="将SELECT替换成空"></a>将SELECT替换成空</h4><p>可以采用嵌套的方式，如SESELECTLECT。</p>
<h4 id="大小写匹配"><a href="#大小写匹配" class="headerlink" title="大小写匹配"></a>大小写匹配</h4><p>在MySQL中，关键字是不区分大小写的，如果只匹配了SELECT就可以通过大小写混写的方式绕过。</p>
<h4 id="正则匹配"><a href="#正则匹配" class="headerlink" title="正则匹配"></a>正则匹配</h4><p>正则匹配关键字<code>\bselect\b</code>可以用形如<code>/*!50000select*/</code>的方式绕过。</p>
<h4 id="替换了单引号或双引号，没有过滤反斜杠"><a href="#替换了单引号或双引号，没有过滤反斜杠" class="headerlink" title="替换了单引号或双引号，没有过滤反斜杠"></a>替换了单引号或双引号，没有过滤反斜杠</h4><p><code>id=&#39;a\&#39; AND title = &#39;OR sleep(1)#&#39;</code><br>反斜杠转义了预置的单引号，实现绕过。</p>
<h3 id="逃逸引号"><a href="#逃逸引号" class="headerlink" title="逃逸引号"></a>逃逸引号</h3><h4 id="编码解码"><a href="#编码解码" class="headerlink" title="编码解码"></a>编码解码</h4><p>当用户输入待转义函数时，如果数据处于编码状态则引号无法被转义。<br>同样的情况也发生在加密/解密、字符集转换的情况。</p>
<ul>
<li>宽字节注入</li>
</ul>
<h4 id="意料之外的输入点"><a href="#意料之外的输入点" class="headerlink" title="意料之外的输入点"></a>意料之外的输入点</h4><p>被遗漏的可控点，例如PHP中，上传的文件名、http header、$_SERVER[‘PHP_SELF’] 等变量。</p>
<h4 id="二次注入"><a href="#二次注入" class="headerlink" title="二次注入"></a>二次注入</h4><p>由于开发者信任数据库中取出的数据是无害的，从而导致二次注入漏洞的出现。</p>
<ul>
<li> 用户名为<code>admin&#39;or&#39;1</code></li>
</ul>
<h4 id="字符串截断"><a href="#字符串截断" class="headerlink" title="字符串截断"></a>字符串截断</h4><p>在标题、抬头等位置，开发者可能限制其字符不能超过x个字符，超过就会被截断。<br>假如攻击者输入<code>aaaa&#39;</code>，自动转义为<code>aaaa\&#39;</code>，由于长度限制被截取为<code>aaaa\</code>，正好转义预置的单引号，实现注入。</p>
<h3 id="注入应用"><a href="#注入应用" class="headerlink" title="注入应用"></a>注入应用</h3><ul>
<li>在有写文件权限的情况下，直接用INTO OUTFILE或DUMPFILE向Web目录写文件，或写文件后结合文件包含漏洞实现代码执行。ref:<a target="_blank" rel="external nofollow noopener noreferrer" href="https://baijiahao.baidu.com/s?id=1650711425682220792&amp;wfr=spider&amp;for=pc">https://baijiahao.baidu.com/s?id=1650711425682220792&amp;wfr=spider&amp;for=pc</a></li>
<li>在有读文件权限的情况下，用load_file()函数读取网站源码和配置信息，获取敏感数据。</li>
<li>提升权限，绕过登录，添加用户，调整用户权限。</li>
<li>通过数据，控制如缓存、模板等文件内容来获取权限，或者删除、读取某些关键文件。</li>
<li>在可以执行多语句的情况下，控制整个数据库，包括控制任意数据、任意字段长度等。</li>
<li>在SQL Server这类数据库中可以直接执行系统命令。</li>
</ul>
<h3 id="总结-3"><a href="#总结-3" class="headerlink" title="总结"></a>总结</h3><p>实际比赛中，应根据不同的SQL服务器类型查找相关资料，通过fuzz得出被过滤的字符、函数、关键词等，在文档中查找未过滤的替代，完成绕过。</p>
<ul>
<li>练习靶场：github-sqli-labs</li>
</ul>
<h2 id="任意文件读取漏洞"><a href="#任意文件读取漏洞" class="headerlink" title="任意文件读取漏洞"></a>任意文件读取漏洞</h2><h3 id="文件读取漏洞常见触发点"><a href="#文件读取漏洞常见触发点" class="headerlink" title="文件读取漏洞常见触发点"></a>文件读取漏洞常见触发点</h3><h4 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h4><p>有关文件读取的标准函数（审计中重点关注）。<br>包括但不限于：</p>
<ul>
<li><code>file_get_contents(),file(),fopen()</code>函数，(及其文件指针操作函数fread(),fgets()等);</li>
<li>与文件包含相关的函数<code>include(),require(),include_once(),require_once()</code>等;</li>
<li>通过PHP读文件的执行系统命令：<code>system(),exec()</code>等。<br>PHP扩展中读取文件的函数：</li>
<li>php-curl扩展</li>
<li>XML模块XXE</li>
</ul>
<p>相关源码阅读：Wrapper和Filter</p>
<p>PHP文件包含的实际问题：<br>    1. 文件路径前面可控，后面不可控：在较低PHP及容器版本中可以使用<code>\x00</code>截断，对应的URL编码是<code>%00</code>。当服务端存在文件上传功能时，也可以尝试利用zip或phar协议直接进行文件包含执行PHP代码。<br>    1. 文件路径后面可控，前面不可控：通过<code>../</code>进行目录穿越读取文件，但这种情况无法使用Wrapper，如果服务器是利用include等文件包含类的函数，将无法读取PHP文件中的PHP代码。<br>    1. 文件路径中间可控：和第一种相似，但无法利用Wrapper进行文件包含。</p>
<h4 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h4><p>漏洞经常出现在框架请求静态资源文件部分，也就是最后读取文件内容的open函数。但直接导致漏洞的原因往往是Python函数的feature被忽略。</p>
<p>除了Python框架，很多其它涉及文件操作的应用也可能因为滥用open函数、模板的不当渲染导致任意文件读取。</p>
<h4 id="JAVA"><a href="#JAVA" class="headerlink" title="JAVA"></a>JAVA</h4><ul>
<li>文件读取函数FileInputStream</li>
<li>XXE</li>
<li>JAVA模块所支持的<code>file://</code>协议</li>
<li>Spring Cloud Config Server 路径穿越与任意文件读取漏洞 CVE-2019-3799, Jenkins 任意文件读取漏洞 CVE-2018-1999002</li>
</ul>
<h4 id="Ruby"><a href="#Ruby" class="headerlink" title="Ruby"></a>Ruby</h4><ul>
<li>通常与Rails框架相关。</li>
<li>Ruby on Rails 远程代码执行漏洞 CVE-2016-0752，Ruby on Rails 路径穿越与任意文件读取漏洞 CVE-2018-3760，Ruby on Rails 路径穿越与任意文件读取漏洞 CVE-2019-5418</li>
</ul>
<h4 id="Node"><a href="#Node" class="headerlink" title="Node"></a>Node</h4><ul>
<li>通常为模板注入、代码注入等。</li>
<li>Node.js express 模块任意文件读取漏洞 CVE-2017-14849</li>
</ul>
<h3 id="中间件-服务器相关"><a href="#中间件-服务器相关" class="headerlink" title="中间件/服务器相关"></a>中间件/服务器相关</h3><h4 id="Nginx错误配置"><a href="#Nginx错误配置" class="headerlink" title="Nginx错误配置"></a>Nginx错误配置</h4><p>常搭配Python-Web应用一起出现。</p>
<ul>
<li>/static../ -&gt; /home/myapp/static/../，产生目录穿越，穿越至myapp目录。原因：location最后没有加‘/’限制<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location &#x2F;static &#123;</span><br><span class="line">  alias &#x2F;home&#x2F;myapp&#x2F;static&#x2F;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h4><p>MySQL：</p>
<ul>
<li>load_file(),利用条件严格，但仍然常出相关文件读取题目。</li>
<li>load data infile，需要执行完整的SQL语句且需要FILE权限，比较少见，除了SSRF攻击MySQL以外，很少能够直接执行整条非基本SQL语句的机会。</li>
</ul>
<h4 id="软链接"><a href="#软链接" class="headerlink" title="软链接"></a>软链接</h4><p>又称符号链接，即soft link或symbolic link。相当于win下的快捷方式。</p>
<p>硬链接与软链接的区别： <a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.jianshu.com/p/b035d94fa959">https://www.jianshu.com/p/b035d94fa959</a></p>
<p>bash命令<code>ln-s</code>可以创建一个指向指定文件的软链接文件，然后将该文件上传至服务器，访问该链接文件时，实际上是在请求服务端它指向的文件。</p>
<h4 id="FFmpeg"><a href="#FFmpeg" class="headerlink" title="FFmpeg"></a>FFmpeg</h4><p>CISCN 2017 FFmpeg 任意文件读取漏洞</p>
<h4 id="Doker-API"><a href="#Doker-API" class="headerlink" title="Doker-API"></a>Doker-API</h4><p>Docker-API可以控制Docker的行为，Docker-API通过UNIX Socket通信，也可以通过HTTP直接通信。当可以通过SSRF漏洞进行UNIX Socket通信时，就可以通过操纵Docker-API把本地文件载入Docker新容器进行读取（利用Docker的ADD、COPY操作）。</p>
<h3 id="客户端相关"><a href="#客户端相关" class="headerlink" title="客户端相关"></a>客户端相关</h3><p>客户端文件读取漏洞，大多基于XSS读取本地文件。</p>
<h4 id="浏览器-Flash-XSS"><a href="#浏览器-Flash-XSS" class="headerlink" title="浏览器/Flash XSS"></a>浏览器/Flash XSS</h4><p>js读取本地文件</p>
<ul>
<li>Safari浏览器 客户端本地文件读取漏洞</li>
</ul>
<h4 id="MarkDown语法解析器XSS"><a href="#MarkDown语法解析器XSS" class="headerlink" title="MarkDown语法解析器XSS"></a>MarkDown语法解析器XSS</h4><p>具有解析js的能力，且缺乏浏览器的读取本地文件限制。</p>
<h2 id="文件读取漏洞常见读取路径"><a href="#文件读取漏洞常见读取路径" class="headerlink" title="文件读取漏洞常见读取路径"></a>文件读取漏洞常见读取路径</h2><h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><h4 id="flag名称（相对路径）"><a href="#flag名称（相对路径）" class="headerlink" title="flag名称（相对路径）"></a>flag名称（相对路径）</h4><p>fuzz方式获取</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flag(.txt|.php|.pyc|.py ...)</span><br><span class="line">flag(.txt|.php|.pyc|.py ...)</span><br><span class="line">[dir_you_know]&#x2F;flag(.txt|.php|.pyc|.py ...)</span><br><span class="line">..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;etc&#x2F;flag(.txt|.php|.pyc|.py ...)</span><br><span class="line">..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;tmp&#x2F;flag(.txt|.php|.pyc|.py ...)</span><br><span class="line">..&#x2F;flag(.txt|.php|.pyc|.py ...)</span><br><span class="line">..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;root&#x2F;flag(.txt|.php|.pyc|.py ...)</span><br><span class="line">..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;home&#x2F;flag(.txt|.php|.pyc|.py ...)</span><br><span class="line">..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;home&#x2F;[user_you_know]&#x2F;flag(.txt|.php|.pyc|.py ...)</span><br></pre></td></tr></table></figure>

<h4 id="服务器信息（绝对路径）"><a href="#服务器信息（绝对路径）" class="headerlink" title="服务器信息（绝对路径）"></a>服务器信息（绝对路径）</h4><p>CTF中常见的部分须知目录和文件</p>
<ol>
<li>/etc目录<br> 多是各种应用或系统配置文件，是进行文件读取的首要目标。</li>
<li>/etc/passwd （详细解析：<a target="_blank" rel="external nofollow noopener noreferrer" href="http://c.biancheng.net/view/839.html%EF%BC%89">http://c.biancheng.net/view/839.html）</a><br> Linux系统保存用户信息及其工作目录的文件，所有用户/组可读，一般用作Linux系统下文件读取漏洞存在判断的基准。从该文件可得系统中存在哪些用户，及其所属组和工作目录。</li>
<li>/etc/shadow （详细解析： <a target="_blank" rel="external nofollow noopener noreferrer" href="http://c.biancheng.net/view/840.html%EF%BC%89">http://c.biancheng.net/view/840.html）</a><br> 是Linux系统保存用户信息及（可能存在）密码（hash）的文件，权限是root用户可读写、shadow组可读。所以一般情况下该文件不可读。</li>
<li>/etc/apache2/*<br> 是Apache的配置文件，可以获知Web目录、服务端口等信息。</li>
<li>/etc/nginx/*<br> 是Nginx配置文件（Ubuntu等系统），可以获知Web目录、服务端口等信息。</li>
<li>/etc/apparmor(.d)/*<br> 是Apparmor配置文件，可以获知各应用系统调用的白名单、黑名单。（如查看MySQL是否禁用系统调用，确定是否可以使用UDF执行系统命令）</li>
<li>/etc/(cron.d/*|crontab)<br> 是定时任务文件。有些题会设置一些定时任务，读取这些配置文件就可以发现隐藏的目录或其它文件。</li>
<li>/etc/environment<br> 是环境变量配置文件之一。环境变量可能存在大量目录信息的泄漏，甚至可能出现secret key泄漏的情况。</li>
<li>/etc/hostname<br> 主机名</li>
<li>/etc/hosts<br> 主机名查询静态表，包含知道域名解析IP的成对信息。通过该文件，可以探测网卡信息和内网IP/域名。</li>
<li>/etc/issue<br> 指明系统版本。</li>
<li>/etc/mysql/*<br> MySQL配置文件。</li>
<li>/etc/php/*<br> PHP配置文件。</li>
<li>/proc目录<br> 通常存储进程动态运行的各种信息，本质上是一种虚拟目录。<br> <em>如果查看非当前进程的信息，pid是可以暴力破解的，如果要查看当前进程，只需/proc/self/代替/proc/[pid]/即可。</em><br> 对应目录下的cmdline可读出比较敏感的信息。<code>/proc/[pid]/cmdline</code><br> 有时我们无法获取当前应用所在的目录，通过cwd命令可以直接跳转到当前目录。<code>/proc/[pid]/cwd/</code><br> 环境变量中可能存在secret_key，也可以通过environ读取。<code>/proc/[pid]/environ</code></li>
<li>其它目录</li>
</ol>

            </div>
        
        <footer class="article-footer">
        </footer>
    </div>
</article>






    
        <article id="post-Notes_HowToHunt-md" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
                    <div class="article-meta">
                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link-link" href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" rel="tag">渗透测试</a>
    </div>

                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/wiki/Notes_HowToHunt-md/">
            <time datetime="2021-04-08T08:05:57.000Z" itemprop="datePublished">2021-04-08</time>
        </a>
    </div>


                        
                            <i class="fa fa-bar-chart"></i>
                            <span id="busuanzi_container_site_pv"><span id="busuanzi_value_page_pv"></span></span>    
                        
                        
                            <div class="article-meta-button">
                                <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Tsunamori/Wiki-site/raw/writing/source/_posts/Notes_HowToHunt-md.md"> Source </a>
                            </div>
                            <div class="article-meta-button">
                                <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Tsunamori/Wiki-site/edit/writing/source/_posts/Notes_HowToHunt-md.md"> Edit </a>
                            </div>
                            <div class="article-meta-button">
                                <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Tsunamori/Wiki-site/commits/writing/source/_posts/Notes_HowToHunt-md.md"> History </a>
                            </div>
                        
                    </div>
                
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/wiki/Notes_HowToHunt-md/">Notes for HowToHunt.md</a>
        </h1>
    

            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
        
            
        
        
            <h2 id="Account-takeover"><a href="#Account-takeover" class="headerlink" title="Account takeover"></a>Account takeover</h2><ol>
<li>Have a session hijacking -&gt; Look for xss to stole the cookies n expand the impact</li>
<li>The target has weak password policy -&gt; Create a (very) weak password n brute force this account to show the POC</li>
<li>Password reset poisoning:<ul>
<li>Go to password reset function -&gt; Enter email n intercept</li>
<li>Change host header to some other host i.e,<pre><code>* Host:target.com
 * Host:attacker.com
</code></pre>
also try to add some headers without changing host like<pre><code>* X-Forwarded-Host: evil.com
 * Referrer: https ://evil.com
</code></pre>
</li>
<li>Forward this if you found that in next request attacker.com means you successfully theft the token.:)</li>
</ul>
</li>
<li>Using CSRF:<ul>
<li>Change Password function</li>
<li>Email change</li>
<li>Change Security Question</li>
</ul>
</li>
<li>Use git recon or google recon to find sensitive data (depends on luck :))</li>
<li>Token leaks in response:<ul>
<li>For registration:<ul>
<li>Intercept the signup request that contains data you have entered.</li>
<li>Click on action -&gt; do -&gt; intercept response to this request.</li>
<li>Click forward.</li>
<li>Check response it that contains any link,any token or otp(one-time password).</li>
</ul>
</li>
<li>For password reset:<ul>
<li>Intercept the forget password option.</li>
<li>Click on action -&gt; do -&gt; intercept response to this request.</li>
<li>Click forward.</li>
<li>Check response it that contains any link,any token or otp.</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="Application-level-DoS"><a href="#Application-level-DoS" class="headerlink" title="Application level DoS"></a>Application level DoS</h2><ol>
<li>Email bounce issues:</li>
</ol>
<p>  <em><strong>ref: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://infosecwriteups.com/an-unexpected-bounty-email-bounce-issues-b9f24a35eb68">https://infosecwriteups.com/an-unexpected-bounty-email-bounce-issues-b9f24a35eb68</a></strong></em></p>
<ol>
<li>Long password DoS:<ul>
<li>Test in Forgot Password Page n Change Password, cuz the registration usually have length limit but others don’t.</li>
<li>Use a password around 150-200 words to check if there has length limit. Then choose a longer password n keep checking the response time, to see if the app crashes for few seconds.</li>
<li>reason: The long password will cause a problem while hashing it for storing in dataset.</li>
</ul>
</li>
<li>Long string DoS:<ul>
<li>Create app and put field like username or address or even profile picture name parameter (second reference) like 1000 character of string .</li>
<li>Search A’s account from B’s account either it will either keeping searching for long time or crash(500 Error code).<br><em><strong>ref: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://shahjerry33.medium.com/long-string-dos-6ba8ceab3aa0">https://shahjerry33.medium.com/long-string-dos-6ba8ceab3aa0</a></strong></em><br><em><strong><a target="_blank" rel="external nofollow noopener noreferrer" href="https://hackerone.com/reports/764434">https://hackerone.com/reports/764434</a></strong></em></li>
</ul>
</li>
</ol>
<h2 id="Authentication-bypass"><a href="#Authentication-bypass" class="headerlink" title="Authentication bypass"></a>Authentication bypass</h2><ol>
<li>2FA bypass<ul>
<li>Response Manipulation<ul>
<li>change the response value of (eg: login) success to ‘true’ from ‘false’</li>
</ul>
</li>
<li>Status Code Manipulation<ul>
<li>change the status code from 4xx to 200 to see if if can bypass</li>
</ul>
</li>
<li>2FA Code Leakage in Response<ul>
<li>check the response of the 2FA Code Triggering Request to see if the code is leaked</li>
</ul>
</li>
<li>JS File Analysis (rare)<ul>
<li>some JS files may contain info about the 2FA code</li>
</ul>
</li>
<li>2FA Code Reusability<ul>
<li>same code can be reused</li>
</ul>
</li>
<li>Lack of Brute-Force Protection<ul>
<li>(possible)</li>
</ul>
</li>
<li>Missing 2FA Code Integrity Validation<ul>
<li>Code for any user acc can be used to bypass the 2FA</li>
</ul>
</li>
<li>CSRF on 2FA Disabling<ul>
<li>signup for two account -&gt; Login into attacker account &amp; capture the disable 2FA request -&gt; generate CSRF POC with .HTML extension -&gt; Login into victim account and fire the request — — -&gt; It disable 2FA which leads to 2FA Bypass.</li>
</ul>
</li>
<li>Password Reset Disable 2FA<ul>
<li>2FA gets disabled on password change/email change</li>
</ul>
</li>
<li>Backup Code Abuse<br><em><strong>ref: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://medium.com/@surendirans7777/2fa-bypass-techniques-32ec135fb7fe">https://medium.com/@surendirans7777/2fa-bypass-techniques-32ec135fb7fe</a></strong></em></li>
<li>Clickjacking on 2FA Disabling Page<ul>
<li>misleading victim to disable the 2FA for the 2FA disabling page</li>
</ul>
</li>
<li>Enabling 2FA doesn’t expire Previously active Sessions<ul>
<li>if the previous session is hijacked n app has session timeout vlun</li>
</ul>
</li>
<li>Bypass 2FA with null or 000000<ul>
<li>enter null or 000000 to bypass</li>
</ul>
</li>
</ul>
</li>
<li>OTP bypass by repeating requests<ul>
<li>create an acc with a non-existing ph num</li>
<li>intercept the request n send to repeater n forward</li>
<li>change the non-existing num to attacker num, get the OTP n register that non-existing num<br><em><strong>ref: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://medium.com/@AGNIHACKERS/otp-bypass-through-response-manipulation-beeb467359d8">https://medium.com/@AGNIHACKERS/otp-bypass-through-response-manipulation-beeb467359d8</a></strong></em></li>
</ul>
</li>
<li>OTP bypass via response manipulation<ul>
<li>change any status, false, error, 0, to true, success, 1. And see if it can bypass the OTP<br><em><strong>ref: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://medium.com/@MAALP/authentication-bypass-using-response-manipulation-6c33eb1257ac">https://medium.com/@MAALP/authentication-bypass-using-response-manipulation-6c33eb1257ac</a></strong></em></li>
</ul>
</li>
</ol>
<h2 id="Broken-link-hijacking"><a href="#Broken-link-hijacking" class="headerlink" title="Broken-link hijacking"></a>Broken-link hijacking</h2><ol>
<li>Broken-link hijacking<ul>
<li>manual check the external link</li>
<li>broken-link-checker<pre><code>* blc -rof --filter-level 3 https://example.com/
</code></pre>
</li>
<li>register the broken link or try to get that username or url</li>
<li>extra ways:<pre><code>* https://ahrefs.com/broken-link-checker
 * https://brokenlinkcheck.com/
</code></pre>
</li>
</ul>
</li>
</ol>
<h2 id="Broken-auth-and-session-management"><a href="#Broken-auth-and-session-management" class="headerlink" title="Broken auth and session management"></a>Broken auth and session management</h2><ol>
<li>Session based bugs<ul>
<li>Old session does not expire<ul>
<li>log in the account through two browser(eg. firefox n chrome)</li>
<li>change pwd or reset pwd on one browser, then refresh the other browser to see if still logged in</li>
</ul>
</li>
<li>Session hijacking (intended behavior)<ul>
<li>login the acc</li>
<li>copy all cookies n logout</li>
<li>paste the cookies n refresh</li>
</ul>
</li>
<li> Password reset link token not expire (insecure configurability)</li>
<li>create acc, request a forget pwd link</li>
<li>don’t use it, instead, change the email to new one</li>
<li>now use the forget pwd link to sent info to the old email n see if pwd is able to change</li>
<li>Server security misconfiguration<ul>
<li>login, play around n logout, goback one page, see if acc is logged in or can view pages limits to the user</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="Bypassing-CSP"><a href="#Bypassing-CSP" class="headerlink" title="Bypassing CSP"></a>Bypassing CSP</h2><ol>
<li>CSP (Content Security Policy) bypass</li>
</ol>
<p>  <em><strong>ref: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://kathan19.gitbook.io/howtohunt/bypassing-csp/csp_bypass">https://kathan19.gitbook.io/howtohunt/bypassing-csp/csp_bypass</a></strong></em></p>
<h2 id="CMS"><a href="#CMS" class="headerlink" title="CMS"></a>CMS</h2><ol>
<li><p>Wordpress</p>
<ul>
<li>Wordpress Detection<ul>
<li>Wappalyzer</li>
<li>WhatRuns</li>
<li>BuildWith</li>
</ul>
</li>
<li>General Scan Tool<ul>
<li>WpScan</li>
</ul>
</li>
<li>xmlrpc.php<ul>
<li>one of the common issue on wp, to get credit, u need to fully exploit n show the impact.</li>
<li>detection:<ul>
<li>site.com/xmlrpc.php</li>
<li>Get the error message about POST request only</li>
</ul>
</li>
<li>exploit<br><em><strong>ref: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://nitesculucian.github.io/2019/07/01/exploiting-the-xmlrpc-php-on-all-wordpress-versions/">https://nitesculucian.github.io/2019/07/01/exploiting-the-xmlrpc-php-on-all-wordpress-versions/</a></strong></em><br><em><strong><a target="_blank" rel="external nofollow noopener noreferrer" href="https://the-bilal-rizwan.medium.com/wordpress-xmlrpc-php-common-vulnerabilites-how-to-exploit-them-d8d3c8600b32">https://the-bilal-rizwan.medium.com/wordpress-xmlrpc-php-common-vulnerabilites-how-to-exploit-them-d8d3c8600b32</a></strong></em><ul>
<li>Intercept the request and change the method GET to POST</li>
<li>List all Methods<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;methodCall&gt;</span><br><span class="line">&lt;methodName&gt;system.listMethods&lt;&#x2F;methodName&gt;</span><br><span class="line">&lt;params&gt;&lt;&#x2F;params&gt;</span><br><span class="line">&lt;&#x2F;methodCall&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>pingback.ping DDoS</li>
</ul>
</li>
</ul>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;methodCall&gt;</span><br><span class="line">&lt;methodName&gt;pingback.ping&lt;&#x2F;methodName&gt;</span><br><span class="line">&lt;params&gt;&lt;param&gt;</span><br><span class="line">&lt;value&gt;&lt;string&gt;http:&#x2F;&#x2F;&lt;YOUR SERVER &gt;:&lt;port&gt;&lt;&#x2F;string&gt;&lt;&#x2F;value&gt;</span><br><span class="line">&lt;&#x2F;param&gt;&lt;param&gt;&lt;value&gt;&lt;string&gt;http:&#x2F;&#x2F;&lt;SOME VALID BLOG FROM THE SITE &gt;&lt;&#x2F;string&gt;</span><br><span class="line">&lt;&#x2F;value&gt;&lt;&#x2F;param&gt;&lt;&#x2F;params&gt;</span><br><span class="line">&lt;&#x2F;methodCall&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>pingback.ping SSRF (internal PORT scan only)</li>
</ul>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;methodCall&gt;</span><br><span class="line">&lt;methodName&gt;pingback.ping&lt;&#x2F;methodName&gt;</span><br><span class="line">&lt;params&gt;&lt;param&gt;</span><br><span class="line">&lt;value&gt;&lt;string&gt;http:&#x2F;&#x2F;&lt;YOUR SERVER &gt;:&lt;port&gt;&lt;&#x2F;string&gt;&lt;&#x2F;value&gt;</span><br><span class="line">&lt;&#x2F;param&gt;&lt;param&gt;&lt;value&gt;&lt;string&gt;http:&#x2F;&#x2F;&lt;SOME VALID BLOG FROM THE SITE &gt;&lt;&#x2F;string&gt;</span><br><span class="line">&lt;&#x2F;value&gt;&lt;&#x2F;param&gt;&lt;&#x2F;params&gt;</span><br><span class="line">&lt;&#x2F;methodCall&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>tools<br>xmlrpc-scan <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/nullfil3/xmlrpc-scan">https://github.com/nullfil3/xmlrpc-scan</a></p>
</li>
<li><p>CVE-2018-6389 (wp &lt;= 4.9.3)</p>
<ul>
<li><p>detection</p>
<ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://gist.github.com/remonsec/4877e9ee2b045aae96be7e2653c41df9">https://gist.github.com/remonsec/4877e9ee2b045aae96be7e2653c41df9</a></li>
</ul>
</li>
<li><p>exploit</p>
<ul>
<li>use DDoS (Doser <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/quitten/doser.py">https://github.com/quitten/doser.py</a>)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 doser.py -t 999 -g &#39;https:&#x2F;&#x2F;site.com&#x2F;fullUrlFromLoadsxploit&#39;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>WP Cornjob DOS</p>
<ul>
<li><p>detection</p>
<ul>
<li>view site.com/wp-cron.php, You will see a Blank page with 200 HTTP status code</li>
</ul>
</li>
<li><p>exploit</p>
<ul>
<li>same tool as above (Doser)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You will see a Blank page with 200 HTTP status code</span><br></pre></td></tr></table></figure>
<p><em><strong>ref: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://medium.com/@thecpanelguy/the-nightmare-that-is-wpcron-php-ae31c1d3ae30">https://medium.com/@thecpanelguy/the-nightmare-that-is-wpcron-php-ae31c1d3ae30</a></strong></em></p>
</li>
</ul>
</li>
<li><p>WP User Enumeration</p>
<ul>
<li>site.com/wp-json/wp/v2/users/</li>
<li>mostly not acceptable, can be used to extend the impact tho</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h2><ol>
<li>CORS (<em><strong>ref: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.packetlabs.net/cross-origin-resource-sharing-cors/">https://www.packetlabs.net/cross-origin-resource-sharing-cors/</a></strong></em>)</li>
</ol>
<ul>
<li>misconfigured CORS<ul>
<li>hunting method 1 (single target)<ul>
<li>crawl the target website n search Access-Control using burp</li>
<li>Try to add Origin Header i.e, Origin:attacker.com or Origin:null or Origin:attacker.target.com or Origin:target.attacker.com</li>
<li>If origin is reflected in response means the target is vuln to CORS</li>
</ul>
</li>
<li>hunting method 2 (multiple means including subdomains)<ul>
<li>find alive subdomains (i.e, subfinder -d domain.com -o target.txt; grep alive: cat target.txt | httpx | tee -a alive.txt), send each subdomain into burp</li>
<li>same as above method</li>
</ul>
</li>
<li>automated tools<ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/chenjj/CORScanner">https://github.com/chenjj/CORScanner</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/lc/theftfuzzer">https://github.com/lc/theftfuzzer</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/s0md3v/Corsy">https://github.com/s0md3v/Corsy</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Shivangx01b/CorsMe">https://github.com/Shivangx01b/CorsMe</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ol start="2">
<li>CORS bypass</li>
</ol>
<ul>
<li>Origin:null</li>
<li>Origin:attacker.com</li>
<li>Origin:attacker.target.com</li>
<li>Origin:attackertarget.com</li>
<li>Origin:sub.attackertarget.com</li>
<li>Origin:attacker.com and then change the method Get to post/Post to Get</li>
<li>Origin:sub.attacker target.com</li>
<li>Origin:sub.attacker%target.com</li>
<li>Origin:attacker.com/target.com</li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://twitter.com/trbughunters/status/1287023673845612546">https://twitter.com/trbughunters/status/1287023673845612546</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://twitter.com/Paresh_parmar1/status/1265251507655630848">https://twitter.com/Paresh_parmar1/status/1265251507655630848</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.corben.io/tricky-CORS/">https://www.corben.io/tricky-CORS/</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://medium.com/@virus0x01/cors-misconfiguration-leading-to-private-information-disclosure-3034cfcb4b93">https://medium.com/@virus0x01/cors-misconfiguration-leading-to-private-information-disclosure-3034cfcb4b93</a></li>
</ul>
<h2 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h2><ol>
<li>CSRF<ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://kathan19.gitbook.io/howtohunt/csrf/csrf">https://kathan19.gitbook.io/howtohunt/csrf/csrf</a></li>
</ul>
</li>
<li>CSRF bypass<ul>
<li>-Change Request Method [POST =&gt; GET]</li>
<li>-Remove Total Token Parameter</li>
<li>-Remove The Token, And Give a Blank Parameter</li>
<li>-Copy a Unused Valid Token , By Dropping The Request and Use That Token</li>
<li>-Use Own CSRF Token To Feed it to Victim</li>
<li>-Replace Value With Of A Token of Same Length</li>
<li>-Reverse Engineer The Token</li>
<li>-Extract Token via HTML injection</li>
<li>-Switch From Non-Form <code>Content-Type: application/json</code> or <code>Content-Type: application/x-url-encoded</code> To <code>Content-Type: form-multipart</code></li>
<li>-Change/delete the last or frist character from the token</li>
<li>-Change referrer to Referrer</li>
<li>-Bypass the regex<ul>
<li>If the site is looking for “bank.com” in the referer URL, maybe “bank.com.attacker.com” or “attacker.com/bank.com” will work.</li>
</ul>
</li>
<li>-Remove the referer header (add this <meta name="”referrer”" content="”no-referrer”"> in your payload or html code)</li>
<li>-Clickjacking (<a target="_blank" rel="external nofollow noopener noreferrer" href="https://owasp.org/www-community/attacks/Clickjacking">https://owasp.org/www-community/attacks/Clickjacking</a>)<ul>
<li>Exploiting clickjacking on the same endpoint bypasses all CSRF protection. Because technically, the request is indeed originating from the legitimate site. If the page where the vulnerable endpoint is located on is vulnerable to clickjacking, all CSRF protection will be rendered irrelevant and you will be able to achieve the same results as a CSRF   attack on the endpoint, albeit with a bit more effort.</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="Finding-CVEs"><a href="#Finding-CVEs" class="headerlink" title="Finding CVEs"></a>Finding CVEs</h2><ol>
<li>CVEs<br>   1.Grab all the subdomains i.e, subfinder -d domain.com | tee -a domains.txt<br>   2.Grap all alive domains i.e,  cat domains.txt | httpx -status-code | grep 200 | cut -d “ “ -f1 | tee -a alive.txt<br>   3.Run nuclei basic-detection,panels,workflows,cves templates differently and store results in different file. i.e, cat alive.txt | nuclei -t nuclei-templates/workflows | tee -a workflows.<br>   4.Read each output carefully with patience.<br>   5.Find interest tech used by target. i.e, jira<br>   6.put that link into browser check the version used by target.<br>   7.Go on google search with jira version exploit.<br>   8.grep the cves<br>   9.Go to twitter in explore tab search CVE(that you found from google) poc or CVE exploit<br>   10.Go to google and put cve or some details grab from   twitter for a better poc read writeups related to that.<br>   11.Try all cves if success report it.:)</li>
</ol>
<h2 id="Check-list"><a href="#Check-list" class="headerlink" title="Check list"></a>Check list</h2><ol>
<li>Web application pentesting checklist<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://kathan19.gitbook.io/howtohunt/checklist/web-application-pentesting-checklist">https://kathan19.gitbook.io/howtohunt/checklist/web-application-pentesting-checklist</a></li>
<li>Web checklist 2<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/KathanP19/HowToHunt/blob/master/CheckList/Web_Checklist_by_Chintan_Gurjar.pdf">https://github.com/KathanP19/HowToHunt/blob/master/CheckList/Web_Checklist_by_Chintan_Gurjar.pdf</a></li>
<li>Web checklist 3<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/KathanP19/HowToHunt/blob/master/CheckList/mindmap.png">https://github.com/KathanP19/HowToHunt/blob/master/CheckList/mindmap.png</a></li>
</ol>
<h2 id="Source-code-review"><a href="#Source-code-review" class="headerlink" title="Source code review"></a>Source code review</h2><ol>
<li>code review tips<ul>
<li>important functions first<br>When reading source code, focus on important functions such as authentication, password reset, state-changing actions and sensitive info reads. (What is the most important would depend on the application.) Then, review how these components interact with other functionality. Finally, audit other less sensitive parts of the application.</li>
<li>follow user input<br>Another approach is to follow the code that processes user input. User input such as HTTP request parameters, HTTP headers, HTTP request paths, database entries, file reads, and file uploads provide the entry points for attackers to exploit the application’s vulnerabilities.This may also help us to find some critical vulnerabilities like xxe,xxs,sql injection</li>
<li>hard-coded secrets n credentials<br>Hard-coded secrets such as API keys, encryption keys and database passwords can be easily discovered during a source code review. You can grep for keywords such as “key”, “secret”, “password”, “encrypt” or regex search for hex or base64 strings (depending on the key format in use).</li>
<li>use of dangerous functions n outdated dependencies<br>Unchecked use of dangerous functions and outdated dependencies are a huge source of bugs. Grep for specific functions for the language you are using and search through the dependency versions list to see if they are outdated.</li>
<li>developer comments, hidden debug functionalities, configuration files, and the .git directory<br>These are things that developers often forget about and they leave the application in a dangerous state. Developer comments can point out obvious programming mistakes, hidden debug functionalities often lead to privilege escalation, config files allow attackers to gather more information about your infrastructure and finally, an exposed .git directory allows attackers to reconstruct your source code.</li>
<li>hidden paths, deprecated endpoints, and endpoints in development<br>These are endpoints that users might not encounter when using the application normally. But if they work and they are discovered by an attacker, it can lead to vulnerabilities such as authentication bypass and sensitive information leak, depending on the exposed endpoint.</li>
<li>weak cryptography or hashing algorithms<br>This is an issue that is hard to find during a black-box test, but easy to spot when reviewing source code. Look for issues such as weak encryption keys, breakable encryption algorithms, and weak hashing algorithms. Grep for terms like ECB, MD4, and MD5.</li>
<li>missing security checks on user input and regex strength<br>Reviewing source code is a great way to find out what kind of security checks are missing. Read through the application’s documentation and test all the edge cases that you can think of. A great resource for what kind of edge cases that you should consider is PayloadsAllTheThings.(github)</li>
<li>missing cookie flags<br>Look out for missing cookie flags such as httpOnly and secure.</li>
<li>unexpected behavior, conditionals, unnecessarily complex and verbose functions<br>Additionally, pay special attention to the application’s unexpected behavior, conditionals, and complex functions. These locations are where obscure bugs are often discovered.</li>
</ul>
</li>
</ol>
<h2 id="EXIF-geo-data-not-stripped"><a href="#EXIF-geo-data-not-stripped" class="headerlink" title="EXIF geo data not stripped"></a>EXIF geo data not stripped</h2><ol>
<li>EXIF geo data not stripped (sensitive info leaked)<ul>
<li>tools<br><a target="_blank" rel="external nofollow noopener noreferrer" href="http://exif.regex.info/exif.cgi">http://exif.regex.info/exif.cgi</a></li>
</ul>
</li>
</ol>
<h2 id="File-upload-bypass"><a href="#File-upload-bypass" class="headerlink" title="File upload bypass"></a>File upload bypass</h2><ol>
<li>File upload bypass<ul>
<li>bypassing normal extension<br>  sth.php.jpg or sth.jpg.php</li>
<li>bypassing the magic byte validation<br>  polyglots</li>
</ul>
</li>
</ol>
<h2 id="Find-origin-IP"><a href="#Find-origin-IP" class="headerlink" title="Find origin IP"></a>Find origin IP</h2><ol>
<li>find origin<ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://kathan19.gitbook.io/howtohunt/find-origin-ip/findorigin">https://kathan19.gitbook.io/howtohunt/find-origin-ip/findorigin</a></li>
</ul>
</li>
</ol>
<h2 id="HTTP-desync-attack"><a href="#HTTP-desync-attack" class="headerlink" title="HTTP desync attack"></a>HTTP desync attack</h2><ol>
<li>HTTP_Desync<ul>
<li>HTTP request smuggling<ul>
<li>how to do<br>ref: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://portswigger.net/web-security/request-smuggling/finding">https://portswigger.net/web-security/request-smuggling/finding</a><br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://portswigger.net/web-security/request-smuggling/exploiting">https://portswigger.net/web-security/request-smuggling/exploiting</a><br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://portswigger.net/research/http-desync-attacks-request-smuggling-reborn">https://portswigger.net/research/http-desync-attacks-request-smuggling-reborn</a><br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://paper.seebug.org/1048/">https://paper.seebug.org/1048/</a></li>
<li>tools<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/defparam/smuggler">https://github.com/defparam/smuggler</a><br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/PortSwigger/http-request-smuggler">https://github.com/PortSwigger/http-request-smuggler</a></li>
<li>testing lab<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://portswigger.net/web-security/request-smuggling">https://portswigger.net/web-security/request-smuggling</a></li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="Host-header-attack"><a href="#Host-header-attack" class="headerlink" title="Host-header attack"></a>Host-header attack</h2><ol>
<li>host-header<br> <a target="_blank" rel="external nofollow noopener noreferrer" href="https://kathan19.gitbook.io/howtohunt/host-header-attack/host-header">https://kathan19.gitbook.io/howtohunt/host-header-attack/host-header</a></li>
</ol>
<h2 id="HTML-injection"><a href="#HTML-injection" class="headerlink" title="HTML-injection"></a>HTML-injection</h2><ol>
<li><p>HTML-injection</p>
<ul>
<li><p>Password reset links are usually addressed to your account name followed by the reset link. Also if the application allows you to have your account name with tags and special characters then you should try this.</p>
</li>
<li><p>steps</p>
<ul>
<li>Create ur acc, edit the name to<code>&lt;h1&gt;attacker&lt;/h1&gt;</code> or <code>&quot;abc&gt;&lt;h1&gt;attacker&lt;/h1&gt;</code><br>and save it.</li>
<li>request a password reset n check the reset email.</li>
<li>see if the <code>&lt;h1&gt;</code> tag executed.</li>
</ul>
</li>
<li><p>tips</p>
<ul>
<li><p>HTML injection are usually considered as low to medium severity bugs but you can escalate the severity by serving a malicious link by using <code>&lt;a href&gt;</code> for eg:<br><code>&lt;h1&gt;attacker&lt;/h1&gt;&lt;a href=&quot;your-controlled-domain&quot;Click here&lt;/a&gt;</code></p>
</li>
<li><p>You can redirect the user to your malicious domain and serve a fake reset password page to steal credentials Also you can serve a previously found XSS page and steal user cookies etc.</p>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="IDOR"><a href="#IDOR" class="headerlink" title="IDOR"></a>IDOR</h2><ol>
<li>IDOR<br> <a target="_blank" rel="external nofollow noopener noreferrer" href="https://kathan19.gitbook.io/howtohunt/idor/idor">https://kathan19.gitbook.io/howtohunt/idor/idor</a></li>
</ol>
<h2 id="JWT-attack"><a href="#JWT-attack" class="headerlink" title="JWT attack"></a>JWT attack</h2><ol>
<li>JWT<br> <a target="_blank" rel="external nofollow noopener noreferrer" href="https://kathan19.gitbook.io/howtohunt/jwt-attack/jwt_attack">https://kathan19.gitbook.io/howtohunt/jwt-attack/jwt_attack</a></li>
</ol>
<h2 id="MFA-bypass"><a href="#MFA-bypass" class="headerlink" title="MFA bypass"></a>MFA bypass</h2><ol>
<li>MFA bypasses<br> <a target="_blank" rel="external nofollow noopener noreferrer" href="https://kathan19.gitbook.io/howtohunt/mfa-bypass/mfa_bypasses">https://kathan19.gitbook.io/howtohunt/mfa-bypass/mfa_bypasses</a></li>
<li>2FA bypass<br> <a target="_blank" rel="external nofollow noopener noreferrer" href="https://kathan19.gitbook.io/howtohunt/mfa-bypass/2fa_bypass">https://kathan19.gitbook.io/howtohunt/mfa-bypass/2fa_bypass</a></li>
</ol>
<h2 id="Misconfigurations"><a href="#Misconfigurations" class="headerlink" title="Misconfigurations"></a>Misconfigurations</h2><ol>
<li><p>default credential n admin panel</p>
<ul>
<li>default credentials basics<br>default software configurations, ie.:</li>
</ul>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.target.com&#x2F;admin</span><br><span class="line">https:&#x2F;&#x2F;www.target.com&#x2F;admin-console</span><br><span class="line">https:&#x2F;&#x2F;www.target.com&#x2F;console</span><br><span class="line">https:&#x2F;&#x2F;admin.target.com</span><br><span class="line">https:&#x2F;&#x2F;admin-console.target.com</span><br><span class="line">https:&#x2F;&#x2F;console.target.com</span><br></pre></td></tr></table></figure>

<ul>
<li>get access from third party<ul>
<li>search the service default credentials if the admin is working on a third party</li>
</ul>
</li>
<li>bypass to get access to login page<ul>
<li>when visiting admin login page is denied, use header injection to bypass, eg, <code>X-Orginal-URL: /admin</code> or <code>X-Rewrite-URL:/admin</code></li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="OAuth"><a href="#OAuth" class="headerlink" title="OAuth"></a>OAuth</h2><ol>
<li>OAuth<br> <a target="_blank" rel="external nofollow noopener noreferrer" href="https://kathan19.gitbook.io/howtohunt/oauth/oauth">https://kathan19.gitbook.io/howtohunt/oauth/oauth</a></li>
</ol>
<h2 id="Open-redirection"><a href="#Open-redirection" class="headerlink" title="Open redirection"></a>Open redirection</h2><ol>
<li>find OpenRedirect trick<ul>
<li>steps<ul>
<li>create an acc, record the user profile link, logout n clean all the cookies.</li>
<li>paste n visit the profile link, it may redirect u to the login like <code>https://samplesite.me/login?next=accounts/profile</code> or <code>https://samplesite.me/login?retUrl=accounts/profile</code></li>
<li>try to exploit the parameter by adding an external domain eg: <code>https://samplesite.me/login?next=https://evil.com/</code> or <code>https://samplesite.me/login?next=https://samplesite.me@evil.com/ #</code>or <code>https://targetweb.com?url=www.targetweb.com.attackersite.com (with created subdomain)</code> (to beat the bad regex filter)</li>
<li>else, try the XSS eg: <code> https://samplesite.me/login?next=javascript:alert(1);//</code></li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="Parameter-pollution"><a href="#Parameter-pollution" class="headerlink" title="Parameter pollution"></a>Parameter pollution</h2><ol>
<li>Parameter pollution in social sharing buttons<ul>
<li>find a social sharing button n get the sharing link.</li>
<li>modified it from <code>https://taget.com/how-to-hunt </code> to such as <code>https://taget.com/how-to-hunt?&amp;u=https://attacker.com/vaya&amp;text=another_site:https://attacker.com/vaya</code></li>
<li>click the share button n see if the attack website is in the sharing content<h2 id="Password-reset-functionality"><a href="#Password-reset-functionality" class="headerlink" title="Password reset functionality"></a>Password reset functionality</h2>Mindmap <a target="_blank" rel="external nofollow noopener noreferrer" href="https://kathan19.gitbook.io/howtohunt/password-reset-functionality/password_reset_functionality">https://kathan19.gitbook.io/howtohunt/password-reset-functionality/password_reset_functionality</a></li>
</ul>
</li>
<li>password reset token leakage<ol>
<li>Sent a password reset request using forget password</li>
<li>Check your email</li>
<li>Copy your reset page link and paste in another tab and make burp intercept on.</li>
<li>Look for every request if you find similar token that is in reset link with other domain like: bat.bing.com or facebook.com</li>
<li>Then there is reset password token leakage.</li>
</ol>
</li>
<li>account takeover by password reset functionality<ol>
<li>email= <a href="mailto:&#118;&#105;&#x63;&#116;&#x69;&#109;&#64;&#x67;&#109;&#97;&#x69;&#x6c;&#46;&#99;&#111;&#x6d;" rel="external nofollow noopener noreferrer" target="_blank">&#118;&#105;&#x63;&#116;&#x69;&#109;&#64;&#x67;&#109;&#97;&#x69;&#x6c;&#46;&#99;&#111;&#x6d;</a>&amp;email=attacker@gmil.com</li>
<li>email= <a href="mailto:&#118;&#x69;&#99;&#x74;&#x69;&#109;&#x40;&#x67;&#109;&#x61;&#x69;&#108;&#x2e;&#99;&#x6f;&#x6d;" rel="external nofollow noopener noreferrer" target="_blank">&#118;&#x69;&#99;&#x74;&#x69;&#109;&#x40;&#x67;&#109;&#x61;&#x69;&#108;&#x2e;&#99;&#x6f;&#x6d;</a>%20email=attacker@gmil.com</li>
<li>email= <a href="mailto:&#118;&#105;&#99;&#116;&#x69;&#x6d;&#x40;&#103;&#109;&#97;&#105;&#x6c;&#x2e;&#99;&#x6f;&#x6d;" rel="external nofollow noopener noreferrer" target="_blank">&#118;&#105;&#99;&#116;&#x69;&#x6d;&#x40;&#103;&#109;&#97;&#105;&#x6c;&#x2e;&#99;&#x6f;&#x6d;</a> |email=attacker@gmil.com</li>
<li>email= <a href="mailto:&#118;&#105;&#99;&#116;&#105;&#x6d;&#x40;&#103;&#109;&#97;&#105;&#108;&#x2e;&#99;&#x6f;&#x6d;" rel="external nofollow noopener noreferrer" target="_blank">&#118;&#105;&#99;&#116;&#105;&#x6d;&#x40;&#103;&#109;&#97;&#105;&#108;&#x2e;&#99;&#x6f;&#x6d;</a>%0d%0acc:<a href="mailto:&#97;&#116;&#x74;&#97;&#x63;&#107;&#101;&#114;&#x40;&#x67;&#x6d;&#105;&#108;&#46;&#99;&#x6f;&#109;" rel="external nofollow noopener noreferrer" target="_blank">&#97;&#116;&#x74;&#97;&#x63;&#107;&#101;&#114;&#x40;&#x67;&#x6d;&#105;&#108;&#46;&#99;&#x6f;&#109;</a></li>
<li>email= <a href="mailto:&#x76;&#105;&#x63;&#x74;&#105;&#109;&#64;&#x67;&#x6d;&#97;&#105;&#x6c;&#x2e;&#99;&#111;&#109;" rel="external nofollow noopener noreferrer" target="_blank">&#x76;&#105;&#x63;&#x74;&#105;&#109;&#64;&#x67;&#x6d;&#97;&#105;&#x6c;&#x2e;&#99;&#111;&#109;</a>&amp;code= my password reset token</li>
</ol>
</li>
</ol>
<h2 id="Rate-limit"><a href="#Rate-limit" class="headerlink" title="Rate limit"></a>Rate limit</h2><ol>
<li><p>rate-limit bypass</p>
<ul>
<li><p>customizing HTTP methods</p>
<ul>
<li><p>change the GET request to POST, PUT, etc.</p>
</li>
<li><p>bypassing rate-limit in API’s try HEAD method</p>
</li>
<li><p>using header to bypass the rate limit<br>(use the following just below the host header)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For: IP</span><br><span class="line">X-Forwarded-IP: IP</span><br><span class="line">X-Client-IP: IP</span><br><span class="line">X-Remote-IP: IP</span><br><span class="line">X-Originating-IP: IP</span><br><span class="line">X-Host: IP</span><br><span class="line">X-Client: IP</span><br><span class="line"></span><br><span class="line">#or use double X-Forwarded-For header</span><br><span class="line">X-Forwarded-For:</span><br><span class="line">X-Forwarded-For: IP</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>addding headers to spoof IP</p>
<ul>
<li>add HTTP headers to spoof IP n evade detection</li>
</ul>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded: 127.0.0.1</span><br><span class="line">X-Forwarded-By: 127.0.0.1</span><br><span class="line">X-Forwarded-For: 127.0.0.1</span><br><span class="line">X-Forwarded-For-Original: 127.0.0.1</span><br><span class="line">X-Forwarder-For: 127.0.0.1</span><br><span class="line">X-Forward-For: 127.0.0.1</span><br><span class="line">Forwarded-For: 127.0.0.1</span><br><span class="line">Forwarded-For-Ip: 127.0.0.1</span><br><span class="line">X-Custom-IP-Authorization: 127.0.0.1</span><br><span class="line">X-Originating-IP: 127.0.0.1</span><br><span class="line">X-Remote-IP: 127.0.0.1</span><br><span class="line">X-Remote-Addr: 127.0.0.1</span><br></pre></td></tr></table></figure>

<ul>
<li>bypass rate limit using special characters<ul>
<li>adding null byte (%00) at the end of the email</li>
<li>try add a space after the email (not encoded)</li>
<li>other characters can be tried to bypass rate limit <code>%0d , %2e , %09 , %20 , %0, %00, %0d%0a, %0a, %0C</code></li>
<li>add a slash (/) at the end of api endpoint<br>from<code>domain.com/v1/login</code> to <code>domain.com/v1/login/</code><br>eg: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://hackerone.com/reports/1067533">https://hackerone.com/reports/1067533</a></li>
</ul>
</li>
<li>using IP rotate burp extension<br>other ref: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://kathan19.gitbook.io/howtohunt/rate-limit/ratelimitbypass">https://kathan19.gitbook.io/howtohunt/rate-limit/ratelimitbypass</a></li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="Recon"><a href="#Recon" class="headerlink" title="Recon"></a>Recon</h2><ol>
<li>recon workflow<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://kathan19.gitbook.io/howtohunt/recon/workflow">https://kathan19.gitbook.io/howtohunt/recon/workflow</a></li>
<li>subdomain enumeration<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://kathan19.gitbook.io/howtohunt/recon/subdomain_enumeration">https://kathan19.gitbook.io/howtohunt/recon/subdomain_enumeration</a></li>
</ol>
<h2 id="SQLI"><a href="#SQLI" class="headerlink" title="SQLI"></a>SQLI</h2><ol>
<li>SQL injection<ul>
<li>send request to burp scanner n proceed with active scan</li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://twitter.com/El3ctr0Byt3s/status/1302706241240731649">https://twitter.com/El3ctr0Byt3s/status/1302706241240731649</a></li>
<li>for getting hidden parameters<ol>
<li>Use subdomain enumeration tools on the domain.</li>
<li>Gather all urls using hakcrawler, waybackurls, gau for the domain and subdomains.</li>
<li>You can use the same method described above in 2nd point.</li>
<li>Use Arjun to scan for the hidden params in the urls.</li>
<li>Use –urls flag to include all urls.</li>
<li>Check the params as <a target="_blank" rel="external nofollow noopener noreferrer" href="https://domain.com/?%60">https://domain.com?`</a><hiddenparam>=<value>`</value></hiddenparam></li>
<li>Send request to file and process it through sqlmap.</li>
</ol>
</li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://kathan19.gitbook.io/howtohunt/sqli/sql_injection">https://kathan19.gitbook.io/howtohunt/sqli/sql_injection</a></li>
</ul>
</li>
</ol>

            </div>
        
        <footer class="article-footer">
        </footer>
    </div>
</article>






    
        <nav id="page-nav">
        <a class="extend prev" rel="prev" href="/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
        </nav>
    
</section>
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            Tsunamori &copy; 2024 
            <a rel="external nofollow noopener noreferrer" target="_blank" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/80x15.png"></a>
            <br> Powered by <a href="http://hexo.io/" target="_blank" rel="external nofollow noopener noreferrer">Hexo</a>. Theme - <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/zthxxx/hexo-theme-Wikitten">wikitten</a>
            
                <br>
                <span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i> <span id="busuanzi_value_site_pv"></span></span>
                &nbsp;|&nbsp;
                <span id="busuanzi_container_site_pv"><i class="fa fa-user"></i> <span id="busuanzi_value_site_uv"></span></span>
            
        </div>
    </div>
</footer>

        

    
        
<script src="/libs/lightgallery/js/lightgallery.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-pager.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-zoom.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-hash.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-share.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-video.min.js"></script>

    
    
        
<script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>

    
    
        <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true,
            TeX: {
                equationNumbers: {
                  autoNumber: 'AMS'
                }
            }
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    



<!-- Custom Scripts -->

<script src="/js/main.js"></script>


    </div>
</body>
</html>